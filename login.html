<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Opessocius</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; color: inherit;">
                    <h1>Opessocius</h1>
                </a>
            </div>
            <nav class="navigation">
                <div class="nav-item">
                    <a href="#" class="nav-link">Solutions</a>
                    <div class="dropdown-menu">
                        <div class="dropdown-preview">
                            <img src="images/InvestmentCalculator.png" alt="Investment Calculator" class="preview-image active" data-item="item-0" />
                            <img src="images/CrudeOilStrategy.png" alt="Crude Oil Strategy" class="preview-image" data-item="item-1" />
                            <img src="images/PortfolioModels.png" alt="Portfolio Models" class="preview-image" data-item="item-2" />
                            <img src="images/RiskManagement.png" alt="Risk Management" class="preview-image" data-item="item-3" />
                            <img src="images/Technology&Execution.png" alt="Technology & Execution" class="preview-image" data-item="item-4" />
                        </div>
                        <div class="dropdown-items">
                            <a href="investment-calculator.html" class="dropdown-item" data-preview="item-0">
                                <span class="dropdown-text">Investment Calculator</span>
                            </a>
                            <a href="crude-oil-strategy.html" class="dropdown-item" data-preview="item-1">
                                <span class="dropdown-text">Crude Oil Strategy</span>
                            </a>
                            <a href="portfolio-models.html" class="dropdown-item" data-preview="item-2">
                                <span class="dropdown-text">Portfolio Models</span>
                            </a>
                            <a href="risk-management.html" class="dropdown-item" data-preview="item-3">
                                <span class="dropdown-text">Risk Management</span>
                            </a>
                            <a href="technology-execution.html" class="dropdown-item" data-preview="item-4">
                                <span class="dropdown-text">Technology & Execution</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link">Resources</a>
                    <div class="dropdown-menu">
                        <div class="dropdown-preview">
                            <img src="images/Trading101.png" alt="Trading 101" class="preview-image active" data-item="item-0" />
                            <img src="images/OilMarketfundamentals.png" alt="Oil Market Fundamentals" class="preview-image" data-item="item-1" />
                            <img src="images/Macro&GeopoliticalInsights.png" alt="Macro & Geopolitical Insights" class="preview-image" data-item="item-2" />
                            <img src="images/TechnicalAnalysisLibrary.png" alt="Technical Analysis Library" class="preview-image" data-item="item-3" />
                            <img src="images/Risk&ExpectationsGuide.png" alt="Risk & Expectations Guide" class="preview-image" data-item="item-4" />
                        </div>
                        <div class="dropdown-items">
                            <a href="learn.html" class="dropdown-item" data-preview="item-0">
                                <span class="dropdown-text">Learn</span>
                            </a>
                            <a href="crude-oil-fundamentals.html" class="dropdown-item" data-preview="item-1">
                                <span class="dropdown-text">Crude Oil Fundamentals</span>
                            </a>
                            <a href="macro-geopolitical-insights.html" class="dropdown-item" data-preview="item-2">
                                <span class="dropdown-text">Macro & Geopolitical Insights</span>
                            </a>
                            <a href="technical-analysis-library.html" class="dropdown-item" data-preview="item-3">
                                <span class="dropdown-text">Technical Analysis Library</span>
                            </a>
                            <a href="risk-expectations-guide.html" class="dropdown-item" data-preview="item-4">
                                <span class="dropdown-text">Risk & Expectations Guide</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link">Consultations</a>
                    <div class="dropdown-menu">
                        <div class="dropdown-preview">
                            <img src="images/AboutUs.png" alt="About Us" class="preview-image active" data-item="item-0" />
                            <img src="images/Pricing&Plans.png" alt="Pricing & Plans" class="preview-image" data-item="item-1" />
                            <img src="images/BookaCall.png" alt="Book a Call" class="preview-image" data-item="item-2" />
                            <img src="images/Compliance&Disclaimers.png" alt="Compliance & Disclaimers" class="preview-image" data-item="item-3" />
                            <img src="images/OnboardingProcess.png" alt="Onboarding Process" class="preview-image" data-item="item-4" />
                        </div>
                        <div class="dropdown-items">
                            <a href="about-us.html" class="dropdown-item" data-preview="item-0">
                                <span class="dropdown-text">About Us</span>
                            </a>
                            <a href="pricing-plans.html" class="dropdown-item" data-preview="item-1">
                                <span class="dropdown-text">Pricing & Plans</span>
                            </a>
                            <a href="book-a-call.html" class="dropdown-item" data-preview="item-2">
                                <span class="dropdown-text">Book a Call</span>
                            </a>
                            <a href="compliance-disclaimers.html" class="dropdown-item" data-preview="item-3">
                                <span class="dropdown-text">Compliance & Disclaimers</span>
                            </a>
                            <a href="onboarding-procedure.html" class="dropdown-item" data-preview="item-4">
                                <span class="dropdown-text">Onboarding Process</span>
                            </a>
                        </div>
                    </div>
                </div>
                <a href="login.html" class="nav-link">Log in</a>
            </nav>
        </div>
    </header>

    <main class="main-content login-main">
        <!-- Login Section -->
        <section class="login-section" id="login-section">
            <div class="login-split-container">
                <div class="login-welcome-section">
                    <div class="login-welcome-content">
                        <h1 class="login-welcome-title">Investor Login</h1>
                        <p class="login-welcome-description">Access your investment dashboard, view portfolio performance, and manage your account with our secure, institutional-grade platform.</p>
                        <button class="login-learn-more-btn">Learn more about Opessocius</button>
                        <a href="book-a-call.html" class="login-support-link">Need support?</a>
                    </div>
                </div>
                <div class="login-form-section">
                    <div class="login-form-container">
                        <form class="login-form" id="login-form">
                            <div class="form-group">
                                <label for="login-username">Username</label>
                                <input type="text" id="login-username" name="username" placeholder="Enter your username" required autofocus>
                            </div>
                            <div class="form-group">
                                <label for="login-password">Password</label>
                                <input type="password" id="login-password" name="password" placeholder="Enter your password" required>
                            </div>
                            <div id="login-error" class="login-error" style="display: none;">Invalid username or password</div>
                            <button type="submit" class="login-submit-btn" id="login-submit-btn" disabled>Login</button>
                            <a href="#" class="forgot-password-link">Forgot Password?</a>
                        </form>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-column">
                <h3>Our Offices</h3>
                <p><strong>Spain</strong><br>Madrid. Castellana, 81<br>Tetuán, 28046</p>
                <p><strong>United Arab Emirates</strong><br>Dubai, The Bay Gate<br>Business Bay</p>
            </div>
            <div class="footer-column">
                <h3>Legal</h3>
                <a href="terms-conditions.html#terms-conditions">Terms &amp; Conditions</a>
                <a href="terms-conditions.html#privacy-policy">Privacy Policy</a>
                <a href="terms-conditions.html#legal-notice">Legal Notice</a>
                <a href="terms-conditions.html#cookie-settings">Cookie Settings</a>
            </div>
            <div class="footer-column">
                <h3>Company</h3>
                <a href="about-us.html">About</a>
                <a href="book-a-call.html">Join us</a>
                <a href="https://www.linkedin.com/in/opessocius" target="_blank" rel="noopener noreferrer">LinkedIn</a>
            </div>
            <div class="footer-column footer-certificates">
                <h3>Accreditations</h3>
                <div class="certificate-row">
                    <div class="certificate-item">
                        <img src="images/iso.png" alt="ISO Certification" />
                    </div>
                    <div class="certificate-item">
                        <img src="images/ias.png" alt="IAS Certification" />
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-disclaimer">
            <p>© 2025 Opessocius Technology</p>
            <p><strong>Disclaimer:</strong></p>
            <p>The information presented on Opessocius' website is provided for informational purposes only. None of the information constitutes investment brokerage (Anlagevermittlung) or investment advice (Anlageberatung). It is not intended to serve as legal, tax, or financial advice, nor as an endorsement of any investment strategy. Opessocius does not provide legal, tax, or financial advice.</p>
            <p>This content does not contain any offer, recommendation, or solicitation to make investment decisions of any kind, including but not limited to investing in shares, financial instruments, or entering into any contractual arrangement. It does not take into account the specific investment objectives, financial situation, or particular needs of any individual investor. Accordingly, the information provided should not be used as a substitute for professional, personalized investment or product-related advice.</p>
            <p>The content on this website is subject to change without notice. While Opessocius aims to present accurate and up-to-date information, it undertakes no obligation to update or revise the content on an ongoing basis.</p>
        </div>
    </footer>
    
    <script src="script.js"></script>
    <!-- Firebase Configuration -->
    <!-- Note: To use npm packages, you need to run a local server (e.g., npx serve or python -m http.server) -->
    <!-- Or use Firebase CDN instead by uncommenting the CDN script below -->
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration and Service -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD9DvEzXUxUppgsp71H5d3abPKWkjkea6A",
            authDomain: "opessocius-17ab9.firebaseapp.com",
            projectId: "opessocius-17ab9",
            storageBucket: "opessocius-17ab9.firebasestorage.app",
            messagingSenderId: "835445796116",
            appId: "1:835445796116:web:71b8595886ecb53e612601",
            measurementId: "G-44CX9N3E3J"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Initialize services
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Make available globally
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        window.firebase = firebase;
        
        // Firestore Service Functions (using CDN API)
        window.firestoreService = {
            USERS_COLLECTION: 'users',
            
            // Get user by username
            getUserByUsername: async function(username) {
                try {
                    const snapshot = await db.collection(this.USERS_COLLECTION)
                        .where('username', '==', username)
                        .limit(1)
                        .get();
                    if (!snapshot.empty) {
                        const doc = snapshot.docs[0];
                        return { id: doc.id, ...doc.data() };
                    }
                    return null;
                } catch (error) {
                    console.error('Error getting user by username:', error);
                    throw error;
                }
            }
        };
        
        // Dispatch event when services are ready
        window.dispatchEvent(new CustomEvent('firestoreReady'));
        
        console.log('Firebase and Firestore initialized successfully from CDN');
    </script>
    <!-- Alternative: Firebase CDN (uncomment to use instead of npm packages) -->
    <!--
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyD9DvEzXUxUppgsp71H5d3abPKWkjkea6A",
            authDomain: "opessocius-17ab9.firebaseapp.com",
            projectId: "opessocius-17ab9",
            storageBucket: "opessocius-17ab9.firebasestorage.app",
            messagingSenderId: "835445796116",
            appId: "1:835445796116:web:71b8595886ecb53e612601",
            measurementId: "G-44CX9N3E3J"
        };
        
        const app = initializeApp(firebaseConfig);
        window.firebaseApp = app;
        window.firebaseAuth = getAuth(app);
        window.firebaseDb = getFirestore(app);
    </script>
    -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Enable/disable login button based on form validity
            const usernameInput = document.getElementById('login-username');
            const passwordInput = document.getElementById('login-password');
            const loginSubmitBtn = document.getElementById('login-submit-btn');
            
            function checkFormValidity() {
                if (usernameInput && passwordInput && loginSubmitBtn) {
                    if (usernameInput.value.trim() !== '' && passwordInput.value.trim() !== '') {
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.style.background = '#2563eb';
                        loginSubmitBtn.style.color = '#ffffff';
                        loginSubmitBtn.style.cursor = 'pointer';
                    } else {
                        loginSubmitBtn.disabled = true;
                        loginSubmitBtn.style.background = '#e5e7eb';
                        loginSubmitBtn.style.color = '#6b7280';
                        loginSubmitBtn.style.cursor = 'not-allowed';
                    }
                }
            }
            
            if (usernameInput) {
                usernameInput.addEventListener('input', checkFormValidity);
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('input', checkFormValidity);
            }

            // Form submission with Firebase Authentication
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const username = usernameInput.value.trim();
                    const password = passwordInput.value.trim();
                    
                    // Show loading state
                    loginSubmitBtn.disabled = true;
                    loginSubmitBtn.textContent = 'Logging in...';
                    
                    try {
                        // Check if Firebase and Firestore are available
                        if (window.firebaseAuth && window.firestoreService) {
                            // Query Firestore to get user by username
                            console.log('Looking up user by username:', username);
                            const userData = await window.firestoreService.getUserByUsername(username);
                            
                            if (userData && userData.email) {
                                // User found, use email for Firebase Auth login
                                console.log('User found, email:', userData.email);
                                try {
                                    const userCredential = await window.firebaseAuth.signInWithEmailAndPassword(
                                        userData.email, 
                                        password
                                    );
                                    const user = userCredential.user;
                                    
                                    // Store user info in sessionStorage
                                    sessionStorage.setItem('user', JSON.stringify({
                                        uid: user.uid,
                                        email: user.email,
                                        username: username,
                                        userData: userData
                                    }));
                                    
                                    // Redirect based on user type/role
                                    if (userData.type === 'admin') {
                                        // Check which admin portal based on username or other criteria
                                        if (username === 'admin' || username.includes('admin')) {
                                            window.location.href = 'adminportal.html';
                                        } else {
                                            window.location.href = 'adminportal.html';
                                        }
                                    } else {
                                        // Investor user
                                        window.location.href = 'investorsportal.html';
                                    }
                                    
                                    return; // Success, exit function
                                } catch (authError) {
                                    console.error('Firebase auth error:', authError);
                                    if (loginError) {
                                        loginError.textContent = 'Invalid password. Please try again.';
                                        loginError.style.display = 'block';
                                    }
                                    passwordInput.value = '';
                                    loginSubmitBtn.disabled = false;
                                    loginSubmitBtn.textContent = 'Login';
                                    return;
                                }
                            } else {
                                // User not found in Firestore, try hardcoded credentials
                                console.log('User not found in Firestore, trying hardcoded credentials');
                                handleHardcodedLogin(username, password);
                            }
                        } else {
                            // Firebase not loaded, use hardcoded credentials
                            console.log('Firebase not available, using hardcoded credentials');
                            handleHardcodedLogin(username, password);
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        handleHardcodedLogin(username, password);
                    } finally {
                        // Reset button state
                        loginSubmitBtn.disabled = false;
                        loginSubmitBtn.textContent = 'Login';
                    }
                });
            }
            
            // Fallback function for hardcoded credentials
            function handleHardcodedLogin(username, password) {
                if (loginError) loginError.style.display = 'none';
                
                if (username === '1' && password === '1') {
                    window.location.href = 'investorsportal.html';
                } else if (username === '2' && password === '2') {
                    window.location.href = 'adminportal.html';
                } else if (username === '3' && password === '3') {
                    window.location.href = 'adminportal2.html';
                } else if (username === '4' && password === '4') {
                    window.location.href = 'adminportal3.html';
                } else {
                    if (loginError) loginError.style.display = 'block';
                    passwordInput.value = '';
                }
            }
        });
    </script>
</body>
</html>

