<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investor Portal - Opessocius</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="dashboard-active">
    <section class="user-dashboard" id="user-dashboard">
        <div class="dashboard-sidebar">
            <div class="sidebar-profile">
                <img src="images/diegorequena.JPG" alt="Investor Profile" class="sidebar-profile-image" />
                <div class="sidebar-profile-name">John Investor</div>
            </div>
            <nav class="sidebar-navigation">
                <a href="#" class="sidebar-nav-item active">
                    <span>Dashboard</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Portfolio</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Transactions</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Performance</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Market News</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Account Settings</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Reports</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Learning</span>
                </a>
                <a href="#" class="sidebar-nav-item">
                    <span>Community</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="index.html" class="sidebar-footer-item">
                    <span>Return to Home</span>
                </a>
                <a href="login.html" class="sidebar-footer-item" id="logout-btn">
                    <span>Logout</span>
                </a>
            </div>
        </div>
        <div class="dashboard-content">
            <!-- Dashboard View -->
            <div class="dashboard-view" id="dashboard-view" style="display: block;">
                <div class="dashboard-widgets-grid">
                    <!-- Crude Oil Price - Top Left -->
                    <div class="dashboard-widget dashboard-widget-oil" style="grid-column: 1; grid-row: 1;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Crude Oil Price</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="tradingview-widget-container-dashboard">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js" async>
                                {
                                    "symbol": "USOIL",
                                    "width": "100%",
                                    "height": "160",
                                    "locale": "en",
                                    "dateRange": "1D",
                                    "colorTheme": "light",
                                    "trendLineColor": "rgba(37, 99, 235, 1)",
                                    "underLineColor": "rgba(37, 99, 235, 0.3)",
                                    "isTransparent": false,
                                    "autosize": true,
                                    "largeChartUrl": ""
                                }
                                </script>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Current Balance - Top Right Row 1 -->
                    <div class="dashboard-widget" style="grid-column: 2; grid-row: 1;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Current Balance</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="dashboard-main-metric" id="dashboard-current-balance">€287,450</div>
                            <div class="dashboard-sub-metric">Capital Invested: €230,000</div>
                        </div>
                    </div>
                    
                    <!-- Total Gain - Top Right Row 1 -->
                    <div class="dashboard-widget" style="grid-column: 3; grid-row: 1;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Total Gain</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="dashboard-main-metric dashboard-metric-positive" id="dashboard-total-gain">+24.98%</div>
                            <div class="dashboard-sub-metric">€57,450 profit</div>
                        </div>
                    </div>
                    
                    <!-- 12 Month Projection - Top Right Row 1 -->
                    <div class="dashboard-widget" style="grid-column: 4; grid-row: 1;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">12 Month Projection</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="dashboard-projection-value" id="dashboard-projection-value">€355,108</div>
                            <div class="dashboard-sub-metric">Projected ending capital</div>
                        </div>
                    </div>
                    
                    <!-- Latest News - Second Row -->
                    <div class="dashboard-widget dashboard-widget-clickable" id="dashboard-news-widget" style="grid-column: 1; grid-row: 2;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Latest News</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="dashboard-news-item">
                                <div class="dashboard-news-title">OPEC+ Maintains Production Cuts</div>
                            </div>
                            <div class="dashboard-news-item">
                                <div class="dashboard-news-title">Crude Oil Prices Rally on Middle East Tensions</div>
                            </div>
                            <div class="dashboard-news-item">
                                <div class="dashboard-news-title">US Shale Production Hits Record High</div>
                            </div>
                            <div class="dashboard-news-item">
                                <div class="dashboard-news-title">China's Oil Demand Growth Slows in Q4</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Latest Report - Second Row -->
                    <div class="dashboard-widget" style="grid-column: 2; grid-row: 2;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Latest Report</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="dashboard-report-item">
                                <div class="dashboard-report-period">November 2024</div>
                                <div class="dashboard-report-metrics">
                                    <span class="dashboard-report-gain">+17.39%</span>
                                    <span class="dashboard-report-balance">€270,000</span>
                                </div>
                                <button class="dashboard-report-download" data-month="2024-11">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="dashboard-report-item">
                                <div class="dashboard-report-period">December 2024</div>
                                <div class="dashboard-report-metrics">
                                    <span class="dashboard-report-gain">+19.57%</span>
                                    <span class="dashboard-report-balance">€275,000</span>
                                </div>
                                <button class="dashboard-report-download" data-month="2024-12">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="dashboard-report-item">
                                <div class="dashboard-report-period">January 2025</div>
                                <div class="dashboard-report-metrics">
                                    <span class="dashboard-report-gain">+21.74%</span>
                                    <span class="dashboard-report-balance">€280,000</span>
                                </div>
                                <button class="dashboard-report-download" data-month="2025-01">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deposit Widget - Second Row -->
                    <div class="dashboard-widget" style="grid-column: 3; grid-row: 2;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Deposit Funds</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <form class="dashboard-transaction-form" id="deposit-form">
                                <div class="dashboard-form-group">
                                    <label for="deposit-amount" class="dashboard-form-label">Amount (€)</label>
                                    <input type="number" id="deposit-amount" class="dashboard-form-input" placeholder="Enter amount" min="1" step="0.01" required>
                                </div>
                                <button type="submit" class="dashboard-form-button dashboard-form-button-deposit">
                                    Send to Advisor
                                </button>
                                <div class="dashboard-form-note">Your advisor will receive the request and respond within 24 hours.</div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Withdrawal Widget - Second Row -->
                    <div class="dashboard-widget" style="grid-column: 4; grid-row: 2;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Withdraw Funds</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <form class="dashboard-transaction-form" id="withdrawal-form">
                                <div class="dashboard-form-group">
                                    <label for="withdrawal-amount" class="dashboard-form-label">Amount (€)</label>
                                    <input type="number" id="withdrawal-amount" class="dashboard-form-input" placeholder="Enter amount" min="1" step="0.01" required>
                                </div>
                                <button type="submit" class="dashboard-form-button dashboard-form-button-withdrawal">
                                    Send to Advisor
                                </button>
                                <div class="dashboard-form-note">Your advisor will receive the request and respond within 24 hours.</div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Top Stories -->
                    <div class="dashboard-widget">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Top Stories</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="tradingview-widget-container-dashboard">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-timeline.js" async>
                                {
                                    "feedMode": "all_symbols",
                                    "colorTheme": "light",
                                    "isTransparent": false,
                                    "displayMode": "regular",
                                    "width": "100%",
                                    "height": "300",
                                    "locale": "en"
                                }
                                </script>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Economic Calendar - Third Row, spans 3 columns -->
                    <div class="dashboard-widget dashboard-widget-wide" style="grid-column: 2 / 5; grid-row: 3;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Economic Calendar</h3>
                            <p class="dashboard-widget-subtitle" style="font-size: 0.75rem; color: #6b7280; margin: 0;">Keep track of key economic events</p>
                        </div>
                        <div class="dashboard-widget-content">
                            <div class="tradingview-widget-container-dashboard">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
                                {
                                    "colorTheme": "light",
                                    "isTransparent": false,
                                    "width": "100%",
                                    "height": "300",
                                    "locale": "en",
                                    "importanceFilter": "-1,0,1"
                                }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Portfolio View -->
            <div class="portfolio-view" id="portfolio-view" style="display: none;">
                <div class="portfolio-balance-cards">
                    <div class="balance-card">
                        <div class="balance-label">Capital Invested</div>
                        <div class="balance-amount" id="capital-invested">€230,000</div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-label">Current Account Balance</div>
                        <div class="balance-amount" id="current-balance">€287,450</div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-label">Total Gain</div>
                        <div class="balance-amount balance-amount-gain" id="total-gain">+24.98%</div>
                    </div>
                    <div class="balance-card">
                        <div class="balance-label">12 Month Projection</div>
                        <div class="balance-amount" id="portfolio-projection">€355,108</div>
                    </div>
                </div>
                <div class="portfolio-chart-container">
                    <div class="portfolio-chart-card">
                        <h3 class="portfolio-chart-title">Investment Performance & Projection</h3>
                        <div class="chart-wrapper">
                            <canvas id="portfolio-chart" width="800" height="400"></canvas>
                            <div id="chart-tooltip" class="chart-tooltip" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transactions View -->
            <div class="transactions-view" id="transactions-view" style="display: none;">
                <div class="transactions-table-container">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Starting Balance</th>
                                <th>Ending Balance</th>
                                <th>Growth %</th>
                                <th>Deposits</th>
                                <th>Withdrawals</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table-body">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Performance View -->
            <div class="performance-view" id="performance-view" style="display: none;">
                <div class="performance-header">
                    <p class="performance-subtitle">Investment Performance Overview</p>
                </div>
                <div class="performance-chart-container">
                    <div class="portfolio-chart-card">
                        <h3 class="portfolio-chart-title">Investment Performance</h3>
                        <div class="chart-wrapper">
                            <canvas id="performance-chart" width="800" height="700"></canvas>
                            <div id="performance-tooltip" class="chart-tooltip" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Settings View -->
            <div class="account-settings-view" id="account-settings-view" style="display: none;">
                <div class="account-settings-content">
                    <h2 class="account-settings-title">Account Information</h2>
                    <div class="account-info-card">
                        <div class="account-info-row">
                            <div class="account-info-label">Full Name</div>
                            <div class="account-info-value">John Investor</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Email Address</div>
                            <div class="account-info-value">john.investor@example.com</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Phone Number</div>
                            <div class="account-info-value">+34 123 456 789</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Account Number</div>
                            <div class="account-info-value">ACC-2024-001234</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Account Status</div>
                            <div class="account-info-value account-status-active">Active</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Member Since</div>
                            <div class="account-info-value">January 2024</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Country</div>
                            <div class="account-info-value">Spain</div>
                        </div>
                    </div>

                    <h2 class="account-settings-title" style="margin-top: 3rem;">Investment Details</h2>
                    <div class="account-info-card">
                        <div class="account-info-row">
                            <div class="account-info-label">Initial Investment</div>
                            <div class="account-info-value">€230,000</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Current Balance</div>
                            <div class="account-info-value">€287,450</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Total Return</div>
                            <div class="account-info-value account-value-positive">+24.98%</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Investment Strategy</div>
                            <div class="account-info-value">Crude Oil Futures</div>
                        </div>
                        <div class="account-info-row">
                            <div class="account-info-label">Assigned Operator Email</div>
                            <div class="account-info-value">operator@opessocius.com</div>
                        </div>
                    </div>

                    <div class="account-settings-note">
                        <p>Want to make changes? Contact support via your assigned operator.</p>
                    </div>
                </div>
            </div>

            <!-- Reports View -->
            <div class="reports-view" id="reports-view" style="display: none;">
                <div class="reports-content">
                    <div class="reports-widgets-container" id="reports-widgets-container">
                        <!-- Widgets will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Learning View -->
            <div class="learning-view" id="learning-view" style="display: none;">
                <!-- Modules List View -->
                <div class="learning-content" id="modules-list-view">
                    <div style="margin-bottom: 2rem;">
                        <h2 style="margin: 0; font-size: 1.5rem; color: #1f2937;">Learning Modules</h2>
                        <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">Explore our comprehensive learning modules to enhance your trading knowledge.</p>
                    </div>
                    
                    <div class="modules-grid" id="modules-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                        <!-- Modules will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Module Detail View -->
                <div class="module-detail-view" id="module-detail-view" style="display: none;">
                    <div style="position: relative; max-width: 900px; margin: 0 auto; padding: 2rem;">
                        <button id="close-module-btn" style="position: absolute; top: 1rem; right: 1rem; background: #1f2937; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1000; transition: background 0.2s;" onmouseover="this.style.background='#374151'" onmouseout="this.style.background='#1f2937'">&times;</button>
                        <div id="module-detail-content" style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <!-- Module content will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Community View -->
            <div class="community-view" id="community-view" style="display: none;">
                <div class="community-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Left Side - Professors Messages Widget -->
                    <div class="dashboard-widget" style="display: flex; flex-direction: column; height: 600px; max-height: 600px;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Professors' Messages</h3>
                        </div>
                        <div class="dashboard-widget-content" style="flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
                            <!-- Professors Messages Area -->
                            <div id="professors-messages-container" style="flex: 1; overflow-y: auto; overflow-x: hidden; padding: 1rem; background: #f9fafb; display: flex; flex-direction: column; gap: 1rem; min-height: 0;">
                                <!-- Professors messages will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Side - Group Chat Widget -->
                    <div class="dashboard-widget" style="display: flex; flex-direction: column; height: 600px; max-height: 600px;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Group Chat</h3>
                        </div>
                        <div class="dashboard-widget-content" style="flex: 1; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
                            <!-- Chat Messages Area -->
                            <div id="community-chat-messages-container" style="flex: 1; overflow-y: auto; overflow-x: hidden; padding: 1rem; background: #f9fafb; display: flex; flex-direction: column; gap: 0.75rem; min-height: 0;">
                                <!-- Messages will be populated by JavaScript -->
                            </div>
                            
                            <!-- Chat Input Area -->
                            <div style="border-top: 1px solid #e5e7eb; padding: 1rem; background: white;">
                                <div id="community-chat-images-preview" style="display: none; margin-bottom: 0.75rem; padding: 0.75rem; background: #f3f4f6; border-radius: 6px;">
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;" id="community-chat-images-preview-container">
                                        <!-- Image previews will be shown here -->
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
                                    <textarea id="community-chat-message-input" placeholder="Type your message..." style="flex: 1; padding: 0.5rem 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; resize: none; font-family: inherit; font-size: 0.875rem; min-height: 40px; max-height: 80px;" rows="1"></textarea>
                                    <label for="community-chat-image-input" style="cursor: pointer; padding: 0.5rem 1rem; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 0.875rem; color: #374151; display: inline-flex; align-items: center; gap: 0.5rem; white-space: nowrap; height: fit-content;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                            <polyline points="21 15 16 10 5 21"></polyline>
                                        </svg>
                                        Add Image
                                    </label>
                                    <input type="file" id="community-chat-image-input" accept="image/*" multiple style="display: none;">
                                    <button type="button" id="community-chat-send-btn" style="cursor: pointer; padding: 0.5rem 1rem; background: #2563eb; color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; white-space: nowrap; height: fit-content; transition: background 0.2s;">
                                        Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Weekly Reports Widget - Full Width Below -->
                    <div class="dashboard-widget" style="grid-column: 1 / -1; margin-top: 0.25rem;">
                        <div class="dashboard-widget-header">
                            <h3 class="dashboard-widget-title">Weekly Reports</h3>
                        </div>
                        <div class="dashboard-widget-content">
                            <div id="weekly-reports-display" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                <!-- Weekly Reports will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market News View -->
            <div class="market-news-view" id="market-news-view" style="display: none;">
                <div class="market-news-content">
                    <div class="market-news-chart-section">
                        <div class="tradingview-widget-container market-news-chart">
                            <div id="market_news_chart"></div>
                            <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                            <script type="text/javascript">
                                new TradingView.widget({
                                    "width": "100%",
                                    "height": 500,
                                    "symbol": "USOIL",
                                    "interval": "60",
                                    "theme": "light",
                                    "style": "1",
                                    "timezone": "Europe/Amsterdam",
                                    "locale": "en",
                                    "allow_symbol_change": true,
                                    "withdateranges": true,
                                    "container_id": "market_news_chart",
                                    "hide_volume": true,
                                    "studies": [
                                        {
                                            "id": "MASimple@tv-basicstudies",
                                            "inputs": {
                                                "length": 200,
                                                "source": "close",
                                                "maType": "EMA"
                                            },
                                            "overrides": {
                                                "plot.color": "#FFFF00",
                                                "plot.linewidth": 3
                                            }
                                        }
                                    ]
                                });
                            </script>
                        </div>
                    </div>
                    <div class="market-news-articles-section">
                        <div class="news-grid">
                            <a href="https://www.reuters.com/business/energy/opec-maintains-production-cuts-global-demand-concerns-2025-01-15/" target="_blank" rel="noopener noreferrer" class="news-card">
                                <div class="news-image-container">
                                    <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&h=400&fit=crop" alt="OPEC+ Production" class="news-image" />
                                    <h3 class="news-title">OPEC+ Maintains Production Cuts Amid Global Demand Concerns</h3>
                                </div>
                            </a>
                            <a href="https://www.bloomberg.com/news/articles/2025-01-12/oil-prices-rally-middle-east-tensions" target="_blank" rel="noopener noreferrer" class="news-card">
                                <div class="news-image-container">
                                    <img src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=800&h=400&fit=crop" alt="Crude Oil Prices" class="news-image" />
                                    <h3 class="news-title">Crude Oil Prices Rally on Middle East Tensions</h3>
                                </div>
                            </a>
                            <a href="https://www.wsj.com/articles/us-shale-production-record-high-2025-01-10" target="_blank" rel="noopener noreferrer" class="news-card">
                                <div class="news-image-container">
                                    <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&h=400&fit=crop" alt="US Shale Production" class="news-image" />
                                    <h3 class="news-title">US Shale Production Hits Record High Despite Lower Prices</h3>
                                </div>
                            </a>
                            <a href="https://www.ft.com/content/china-oil-demand-slowdown-q4-2024" target="_blank" rel="noopener noreferrer" class="news-card">
                                <div class="news-image-container">
                                    <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=400&fit=crop" alt="China Oil Demand" class="news-image" />
                                    <h3 class="news-title">China's Oil Demand Growth Slows in Q4 2024</h3>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation handling
            const navItems = document.querySelectorAll('.sidebar-nav-item');
            const dashboardView = document.getElementById('dashboard-view');
            const portfolioView = document.getElementById('portfolio-view');
            const transactionsView = document.getElementById('transactions-view');
            const performanceView = document.getElementById('performance-view');

            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Get text from span element
                    const span = this.querySelector('span');
                    const navText = span ? span.textContent.trim() : this.textContent.trim();
                    
                    // Remove active class from all items
                    navItems.forEach(nav => nav.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Get all views
                    const marketNewsView = document.getElementById('market-news-view');
                    const accountSettingsView = document.getElementById('account-settings-view');
                    const reportsView = document.getElementById('reports-view');
                    const learningView = document.getElementById('learning-view');
                    const communityView = document.getElementById('community-view');
                    
                    // Hide all views
                    if (dashboardView) dashboardView.style.display = 'none';
                    if (portfolioView) portfolioView.style.display = 'none';
                    if (transactionsView) transactionsView.style.display = 'none';
                    if (performanceView) performanceView.style.display = 'none';
                    if (marketNewsView) marketNewsView.style.display = 'none';
                    if (accountSettingsView) accountSettingsView.style.display = 'none';
                    if (reportsView) reportsView.style.display = 'none';
                    if (learningView) learningView.style.display = 'none';
                    if (communityView) communityView.style.display = 'none';
                    
                    // Show selected view
                    if (navText === 'Dashboard' && dashboardView) {
                        dashboardView.style.display = 'block';
                    } else if (navText === 'Portfolio' && portfolioView) {
                        portfolioView.style.display = 'block';
                        setTimeout(function() {
                            drawPortfolioChart();
                            calculateProjectionValue();
                        }, 100);
                    } else if (navText === 'Transactions' && transactionsView) {
                        transactionsView.style.display = 'block';
                        populateTransactionsTable();
                    } else if (navText === 'Performance' && performanceView) {
                        performanceView.style.display = 'block';
                        setTimeout(function() {
                            drawPerformanceChart();
                            setTimeout(setupPerformanceChartHover, 150);
                        }, 100);
                    } else if (navText === 'Market News' && marketNewsView) {
                        marketNewsView.style.display = 'block';
                    } else if (navText === 'Account Settings' && accountSettingsView) {
                        accountSettingsView.style.display = 'block';
                    } else if (navText === 'Reports' && reportsView) {
                        reportsView.style.display = 'block';
                        setTimeout(function() {
                            generateReportWidgets();
                        }, 100);
                    } else if (navText === 'Learning' && learningView) {
                        learningView.style.display = 'block';
                        loadModulesList();
                    } else if (navText === 'Community' && communityView) {
                        communityView.style.display = 'block';
                        loadCommunityChatMessages();
                        loadProfessorsMessages();
                        loadWeeklyReports();
                    }
                });
            });

            // Portfolio Chart Function
            let chartDataPoints = [];
            
            function drawPortfolioChart() {
                const canvas = document.getElementById('portfolio-chart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const container = canvas.parentElement;
                const width = container ? container.clientWidth - 64 : 800;
                const height = 480;
                
                // Set canvas size
                canvas.width = width;
                canvas.height = height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Chart configuration
                const padding = { top: 40, right: 40, bottom: 60, left: 80 };
                const chartWidth = width - padding.left - padding.right;
                const chartHeight = height - padding.top - padding.bottom;
                
                // Sample data: Historical (12 months) + Projection (12 months) = 24 months total
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',
                              'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                
                // Historical data (past 12 months) - starting from initial investment
                const initialInvestment = 230000;
                const historicalData = [
                    230000, 235000, 238000, 242000, 245000, 248000, 252000, 255000, 260000, 265000, 270000, 275000
                ];
                
                // Projection data continues seamlessly from last historical value
                const lastHistoricalValue = historicalData[historicalData.length - 1];
                const projectionData = [
                    280000, 285000, 290000, 295000, 300000, 305000, 310000, 315000, 320000, 325000, 330000, 335000
                ];
                
                // Combine data
                const allData = [...historicalData, ...projectionData];
                const maxValue = Math.max(...allData) * 1.1;
                const minValue = Math.min(...allData) * 0.9;
                const valueRange = maxValue - minValue;
                
                // Store data points for hover interaction
                chartDataPoints = [];
                
                // Calculate x and y positions for all points
                allData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / 24) * index + (chartWidth / 24) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    const growthPercent = ((value - initialInvestment) / initialInvestment * 100).toFixed(2);
                    chartDataPoints.push({
                        x: x,
                        y: y,
                        value: value,
                        month: months[index],
                        growthPercent: growthPercent,
                        isHistorical: index < 12
                    });
                });
                
                // Draw grid lines
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = padding.top + (chartHeight / 5) * i;
                    ctx.beginPath();
                    ctx.moveTo(padding.left, y);
                    ctx.lineTo(width - padding.right, y);
                    ctx.stroke();
                }
                
                // Draw area fill below the line (only historical section with gradient)
                const gradient = ctx.createLinearGradient(
                    padding.left, 
                    padding.top, 
                    padding.left + (chartWidth / 24) * 12, 
                    padding.top + chartHeight
                );
                gradient.addColorStop(0, 'rgba(37, 99, 235, 0.25)');
                gradient.addColorStop(1, 'rgba(37, 99, 235, 0.05)');
                
                ctx.beginPath();
                const firstX = padding.left + (chartWidth / 24) / 2;
                const firstY = padding.top + chartHeight - ((historicalData[0] - minValue) / valueRange) * chartHeight;
                ctx.moveTo(firstX, height - padding.bottom);
                ctx.lineTo(firstX, firstY);
                
                // Historical area only
                historicalData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / 24) * index + (chartWidth / 24) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    ctx.lineTo(x, y);
                });
                
                // Close at the last historical point
                const lastHistoricalX = padding.left + (chartWidth / 24) * 11 + (chartWidth / 24) / 2;
                ctx.lineTo(lastHistoricalX, height - padding.bottom);
                ctx.closePath();
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Draw historical line
                ctx.beginPath();
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 2.5;
                historicalData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / 24) * index + (chartWidth / 24) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                
                // Draw projection line (dashed, green, continuing from historical)
                ctx.beginPath();
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([6, 4]);
                projectionData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / 24) * (12 + index) + (chartWidth / 24) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        // Connect to last historical point
                        const lastHistX = padding.left + (chartWidth / 24) * 11 + (chartWidth / 24) / 2;
                        const lastHistY = padding.top + chartHeight - ((historicalData[11] - minValue) / valueRange) * chartHeight;
                        ctx.moveTo(lastHistX, lastHistY);
                    }
                    ctx.lineTo(x, y);
                });
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw smaller, more formal data points (blue for historical, green for projection)
                allData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / 24) * index + (chartWidth / 24) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    const isHistorical = index < 12;
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.strokeStyle = isHistorical ? '#2563eb' : '#10b981';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                });
                
                // Draw Y-axis labels
                ctx.fillStyle = '#6b7280';
                ctx.font = '12px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                ctx.textAlign = 'right';
                ctx.textBaseline = 'middle';
                for (let i = 0; i <= 5; i++) {
                    const value = minValue + (valueRange / 5) * (5 - i);
                    const y = padding.top + (chartHeight / 5) * i;
                    const formattedValue = '€' + (value / 1000).toFixed(0) + 'k';
                    ctx.fillText(formattedValue, padding.left - 10, y);
                }
                
                // Draw X-axis labels
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                for (let i = 0; i < 24; i += 2) {
                    const x = padding.left + (chartWidth / 24) * i + (chartWidth / 24) / 2;
                    ctx.fillText(months[i], x, height - padding.bottom + 10);
                }
            }
            
            // Add hover tooltip functionality
            function setupChartHover() {
                const canvas = document.getElementById('portfolio-chart');
                const tooltip = document.getElementById('chart-tooltip');
                if (!canvas || !tooltip) return;
                
                canvas.addEventListener('mousemove', function(e) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Find nearest data point
                    let nearestPoint = null;
                    let minDistance = Infinity;
                    
                    chartDataPoints.forEach(point => {
                        const distance = Math.sqrt(Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2));
                        if (distance < 30 && distance < minDistance) {
                            minDistance = distance;
                            nearestPoint = point;
                        }
                    });
                    
                    if (nearestPoint) {
                        const formattedValue = '€' + nearestPoint.value.toLocaleString('en-US');
                        const growthSign = parseFloat(nearestPoint.growthPercent) >= 0 ? '+' : '';
                        tooltip.innerHTML = `
                            <div class="tooltip-balance">${formattedValue}</div>
                            <div class="tooltip-growth">${growthSign}${nearestPoint.growthPercent}%</div>
                        `;
                        tooltip.style.display = 'block';
                        tooltip.style.left = (nearestPoint.x + 10) + 'px';
                        tooltip.style.top = (nearestPoint.y - 40) + 'px';
                    } else {
                        tooltip.style.display = 'none';
                    }
                });
                
                canvas.addEventListener('mouseleave', function() {
                    if (tooltip) tooltip.style.display = 'none';
                });
            }
            
            // Setup hover after chart is drawn
            setTimeout(setupChartHover, 150);

            // Transactions Table Population
            function populateTransactionsTable() {
                const tableBody = document.getElementById('transactions-table-body');
                if (!tableBody) return;

                // Historical data matching the chart
                const initialInvestment = 230000;
                // Data starts from January 2024
                const startYear = 2024;
                const monthlyData = [
                    { ending: 230000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 235000, deposits: 5000, withdrawals: 0, depositDate: '2024-01-15', withdrawalDate: null },
                    { ending: 238000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 242000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 245000, deposits: 3000, withdrawals: 0, depositDate: '2024-04-10', withdrawalDate: null },
                    { ending: 248000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 252000, deposits: 4000, withdrawals: 0, depositDate: '2024-06-20', withdrawalDate: null },
                    { ending: 255000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 260000, deposits: 5000, withdrawals: 0, depositDate: '2024-08-05', withdrawalDate: null },
                    { ending: 265000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 270000, deposits: 0, withdrawals: 0, depositDate: null, withdrawalDate: null },
                    { ending: 275000, deposits: 0, withdrawals: 5000, depositDate: null, withdrawalDate: '2024-11-18' }
                ];

                const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];

                tableBody.innerHTML = '';

                monthlyData.forEach((data, index) => {
                    const startingBalance = index === 0 ? initialInvestment : monthlyData[index - 1].ending;
                    const endingBalance = data.ending;
                    // Calculate growth excluding deposits and including withdrawals
                    const netGrowth = endingBalance - startingBalance - (data.deposits || 0) + (data.withdrawals || 0);
                    const growth = startingBalance > 0 ? (netGrowth / startingBalance * 100).toFixed(2) : '0.00';
                    const growthValue = parseFloat(growth);
                    
                    // Calculate year (assuming data starts in January 2024)
                    const monthIndex = index;
                    const year = startYear + Math.floor(monthIndex / 12);
                    const monthName = months[monthIndex % 12];
                    const monthYear = `${monthName} ${year}`;
                    
                    const row = document.createElement('tr');
                    
                    // Format dates
                    const depositDisplay = data.depositDate 
                        ? `€${data.deposits.toLocaleString('en-US')}<br><span class="transaction-date">${formatDate(data.depositDate)}</span>`
                        : '-';
                    
                    const withdrawalDisplay = data.withdrawalDate 
                        ? `€${data.withdrawals.toLocaleString('en-US')}<br><span class="transaction-date">${formatDate(data.withdrawalDate)}</span>`
                        : '-';

                    row.innerHTML = `
                        <td>${monthYear}</td>
                        <td>€${startingBalance.toLocaleString('en-US')}</td>
                        <td>€${endingBalance.toLocaleString('en-US')}</td>
                        <td class="${growthValue >= 0 ? 'growth-positive' : 'growth-negative'}">${growthValue >= 0 ? '+' : ''}${growth}%</td>
                        <td class="transaction-cell">${depositDisplay}</td>
                        <td class="transaction-cell">${withdrawalDisplay}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            }

            // Performance Chart Function
            let performanceDataPoints = [];
            
            function drawPerformanceChart() {
                const canvas = document.getElementById('performance-chart');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const container = canvas.parentElement;
                const width = container ? container.clientWidth - 64 : 800;
                const height = 700;
                
                // Set canvas size
                canvas.width = width;
                canvas.height = height;
                
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Chart configuration
                const padding = { top: 80, right: 40, bottom: 60, left: 80 };
                const chartWidth = width - padding.left - padding.right;
                const chartHeight = height - padding.top - padding.bottom;
                
                const months = ['Start', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',
                              'Jan', 'Feb', 'Mar', 'Apr'];
                
                // Use actual account balance values (not normalized)
                const initialInvestment = 230000;
                
                // Historical data (12 months) - actual account balances - with Month 0
                // All lines start from the exact same initial investment
                const opessociusHistorical = [
                    initialInvestment,  // Month 0 - exact same starting balance as S&P 500 and Banks
                    235000, 238000, 242000, 245000, 248000, 252000, 255000, 260000, 265000, 270000, 275000, 280000
                ];
                
                // Projection data (4 months) - fixed values (2% compound growth per month for Opessocius)
                const lastHistoricalValue = opessociusHistorical[12];
                const projectionData = [
                    lastHistoricalValue * 1.02,
                    lastHistoricalValue * 1.02 * 1.02,
                    lastHistoricalValue * 1.02 * 1.02 * 1.02,
                    lastHistoricalValue * 1.02 * 1.02 * 1.02 * 1.02
                ];
                
                // S&P 500 monthly returns (%): +2.3%, −1.4%, +3.1%, +0.6%, −2.8%, +4.5%, +1.2%, −3.6%, +2.9%, +0.4%, +5.1%, −1.9%, +1.7%, +3.8%, −0.7%, +2.5%
                const sp500MonthlyReturns = [
                    2.3, -1.4, 3.1, 0.6, -2.8, 4.5, 1.2, -3.6, 2.9, 0.4, 5.1, -1.9,  // 12 historical
                    1.7, 3.8, -0.7, 2.5  // 4 projection
                ];
                
                // Calculate S&P 500 values - SIMPLE INTEREST (no compound, each return based on initial investment)
                const sp500DataRaw = [initialInvestment]; // Month 0
                let cumulativeReturn = 0;
                sp500MonthlyReturns.forEach((returnPercent) => {
                    cumulativeReturn += returnPercent;
                    const monthValue = initialInvestment * (1 + cumulativeReturn / 100);
                    sp500DataRaw.push(monthValue);
                });
                
                // Light smoothing for S&P 500 (2-point average) to reduce sharp peaks but keep volatility visible
                function lightSmooth(data) {
                    const smoothed = [data[0]]; // Keep month 0 unchanged
                    for (let i = 1; i < data.length; i++) {
                        if (i === data.length - 1) {
                            smoothed.push(data[i]);
                        } else {
                            // Average with adjacent points (60% current, 20% each adjacent)
                            smoothed.push(data[i] * 0.6 + data[i - 1] * 0.2 + data[i + 1] * 0.2);
                        }
                    }
                    return smoothed;
                }
                
                const sp500Data = lightSmooth(sp500DataRaw);
                
                // Split S&P 500 data into historical and projection (Month 0 + 12 historical, 4 projection)
                const sp500Historical = sp500Data.slice(0, 13); // Month 0 + 12 months
                const sp500Projection = sp500Data.slice(13, 17); // 4 months
                
                // Banks: constant 0.20% monthly growth - SIMPLE INTEREST (no compound)
                // Ensure it starts from exact same initial investment
                const banksMonthlyGrowth = 0.20; // 0.20% per month
                const banksData = [initialInvestment]; // Month 0 - exact same starting balance
                for (let i = 1; i <= 16; i++) {
                    // Simple interest: add 0.20% of initial investment each month
                    const monthValue = initialInvestment * (1 + (banksMonthlyGrowth * i) / 100);
                    banksData.push(monthValue);
                }
                
                // Split Banks data into historical and projection
                const banksHistorical = banksData.slice(0, 13); // Month 0 + 12 months
                const banksProjection = banksData.slice(13, 17); // 4 months
                
                
                // Combine all data for max/min calculation
                const allData = [...opessociusHistorical, ...projectionData, ...sp500Data, ...banksData];
                const maxValue = Math.max(...allData) * 1.1;
                const minValue = Math.min(...allData) * 0.9;
                const valueRange = maxValue - minValue;
                
                // Store data points for hover
                performanceDataPoints = [];
                
                // Draw grid lines
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
                for (let i = 0; i <= 5; i++) {
                    const y = padding.top + (chartHeight / 5) * i;
                    ctx.beginPath();
                    ctx.moveTo(padding.left, y);
                    ctx.lineTo(width - padding.right, y);
                    ctx.stroke();
                }
                
                // Total months: 17 (Month 0 + 12 historical + 4 projection)
                const totalMonths = 17;
                
                // Draw area fill for user investment historical section only (Month 0 + 12 months)
                const gradient = ctx.createLinearGradient(
                    padding.left, 
                    padding.top, 
                    padding.left + (chartWidth / totalMonths) * 13, 
                    padding.top + chartHeight
                );
                gradient.addColorStop(0, 'rgba(37, 99, 235, 0.25)');
                gradient.addColorStop(1, 'rgba(37, 99, 235, 0.05)');
                
                ctx.beginPath();
                const firstX = padding.left + (chartWidth / totalMonths) / 2;
                const firstY = padding.top + chartHeight - ((opessociusHistorical[0] - minValue) / valueRange) * chartHeight;
                ctx.moveTo(firstX, height - padding.bottom);
                ctx.lineTo(firstX, firstY);
                
                opessociusHistorical.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    ctx.lineTo(x, y);
                });
                
                const lastHistoricalX = padding.left + (chartWidth / totalMonths) * 12 + (chartWidth / totalMonths) / 2;
                ctx.lineTo(lastHistoricalX, height - padding.bottom);
                ctx.closePath();
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Draw area fill for S&P 500 historical section only - orange shade (Month 0 + 12 months)
                const sp500Gradient = ctx.createLinearGradient(
                    padding.left, 
                    padding.top, 
                    padding.left + (chartWidth / totalMonths) * 13, 
                    padding.top + chartHeight
                );
                sp500Gradient.addColorStop(0, 'rgba(249, 115, 22, 0.25)');
                sp500Gradient.addColorStop(1, 'rgba(249, 115, 22, 0.05)');
                
                ctx.beginPath();
                const sp500FirstX = padding.left + (chartWidth / totalMonths) / 2;
                const sp500FirstY = padding.top + chartHeight - ((sp500Historical[0] - minValue) / valueRange) * chartHeight;
                ctx.moveTo(sp500FirstX, height - padding.bottom);
                ctx.lineTo(sp500FirstX, sp500FirstY);
                
                sp500Historical.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    ctx.lineTo(x, y);
                });
                
                const sp500LastHistoricalX = padding.left + (chartWidth / totalMonths) * 12 + (chartWidth / totalMonths) / 2;
                ctx.lineTo(sp500LastHistoricalX, height - padding.bottom);
                ctx.closePath();
                ctx.fillStyle = sp500Gradient;
                ctx.fill();
                
                // Draw area fill for Banks historical section only - grey shade (Month 0 + 12 months)
                const banksGradient = ctx.createLinearGradient(
                    padding.left, 
                    padding.top, 
                    padding.left + (chartWidth / totalMonths) * 13, 
                    padding.top + chartHeight
                );
                banksGradient.addColorStop(0, 'rgba(107, 114, 128, 0.25)');
                banksGradient.addColorStop(1, 'rgba(107, 114, 128, 0.05)');
                
                ctx.beginPath();
                const banksFirstX = padding.left + (chartWidth / totalMonths) / 2;
                const banksFirstY = padding.top + chartHeight - ((banksHistorical[0] - minValue) / valueRange) * chartHeight;
                ctx.moveTo(banksFirstX, height - padding.bottom);
                ctx.lineTo(banksFirstX, banksFirstY);
                
                banksHistorical.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    ctx.lineTo(x, y);
                });
                
                const banksLastHistoricalX = padding.left + (chartWidth / totalMonths) * 12 + (chartWidth / totalMonths) / 2;
                ctx.lineTo(banksLastHistoricalX, height - padding.bottom);
                ctx.closePath();
                ctx.fillStyle = banksGradient;
                ctx.fill();
                
                // Draw Opessocius historical line
                ctx.beginPath();
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 2.5;
                opessociusHistorical.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                
                // Draw Opessocius projection line (dashed, green)
                ctx.beginPath();
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([6, 4]);
                projectionData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * (13 + index) + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        // Connect to last historical point
                        const lastHistX = padding.left + (chartWidth / totalMonths) * 12 + (chartWidth / totalMonths) / 2;
                        const lastHistY = padding.top + chartHeight - ((opessociusHistorical[12] - minValue) / valueRange) * chartHeight;
                        ctx.moveTo(lastHistX, lastHistY);
                    }
                    ctx.lineTo(x, y);
                });
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw S&P 500 historical line (orange) - straight lines to show ups and downs
                ctx.beginPath();
                ctx.strokeStyle = '#f97316';
                ctx.lineWidth = 2.5;
                sp500Historical.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                
                // Draw S&P 500 projection line (dashed, orange)
                ctx.beginPath();
                ctx.strokeStyle = '#f97316';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([6, 4]);
                sp500Projection.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * (13 + index) + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        // Connect to last historical point
                        const lastHistX = padding.left + (chartWidth / totalMonths) * 12 + (chartWidth / totalMonths) / 2;
                        const lastHistY = padding.top + chartHeight - ((sp500Historical[12] - minValue) / valueRange) * chartHeight;
                        ctx.moveTo(lastHistX, lastHistY);
                    }
                    ctx.lineTo(x, y);
                });
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw Banks historical line (grey) - constant growth
                ctx.beginPath();
                ctx.strokeStyle = '#6b7280';
                ctx.lineWidth = 2.5;
                banksHistorical.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                
                // Draw Banks projection line (dashed, grey)
                ctx.beginPath();
                ctx.strokeStyle = '#6b7280';
                ctx.lineWidth = 2.5;
                ctx.setLineDash([6, 4]);
                banksProjection.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * (13 + index) + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    
                    if (index === 0) {
                        // Connect to last historical point
                        const lastHistX = padding.left + (chartWidth / totalMonths) * 12 + (chartWidth / totalMonths) / 2;
                        const lastHistY = padding.top + chartHeight - ((banksHistorical[12] - minValue) / valueRange) * chartHeight;
                        ctx.moveTo(lastHistX, lastHistY);
                    }
                    ctx.lineTo(x, y);
                });
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw data points for Opessocius investment
                [...opessociusHistorical, ...projectionData].forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    const isHistorical = index < 13; // Month 0 + 12 months
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.strokeStyle = isHistorical ? '#2563eb' : '#10b981';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Store for hover
                    const growthPercent = ((value - initialInvestment) / initialInvestment * 100).toFixed(2);
                    performanceDataPoints.push({
                        x: x,
                        y: y,
                        value: value,
                        month: months[index],
                        name: 'Investment',
                        color: isHistorical ? '#2563eb' : '#10b981',
                        growthPercent: growthPercent,
                        isHistorical: isHistorical
                    });
                });
                
                // Draw data points for S&P 500
                sp500Data.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    const isHistorical = index < 13; // Month 0 + 12 months
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.strokeStyle = '#f97316';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Store for hover
                    const growthPercent = ((value - initialInvestment) / initialInvestment * 100).toFixed(2);
                    performanceDataPoints.push({
                        x: x,
                        y: y,
                        value: value,
                        month: months[index],
                        name: 'S&P 500',
                        color: '#f97316',
                        growthPercent: growthPercent,
                        isHistorical: isHistorical
                    });
                });
                
                // Draw data points for Banks
                banksData.forEach((value, index) => {
                    const x = padding.left + (chartWidth / totalMonths) * index + (chartWidth / totalMonths) / 2;
                    const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                    const isHistorical = index < 13; // Month 0 + 12 months
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.strokeStyle = '#6b7280';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(x, y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Store for hover
                    const growthPercent = ((value - initialInvestment) / initialInvestment * 100).toFixed(2);
                    performanceDataPoints.push({
                        x: x,
                        y: y,
                        value: value,
                        month: months[index],
                        name: 'Banks',
                        color: '#6b7280',
                        growthPercent: growthPercent,
                        isHistorical: isHistorical
                    });
                });
                
                // Draw Y-axis labels (in euros)
                ctx.fillStyle = '#6b7280';
                ctx.font = '12px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                ctx.textAlign = 'right';
                ctx.textBaseline = 'middle';
                for (let i = 0; i <= 5; i++) {
                    const value = minValue + (valueRange / 5) * (5 - i);
                    const y = padding.top + (chartHeight / 5) * i;
                    const formattedValue = '€' + (value / 1000).toFixed(0) + 'k';
                    ctx.fillText(formattedValue, padding.left - 10, y);
                }
                
                // Draw X-axis labels (17 months total: Month 0 + 12 historical + 4 projection)
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                for (let i = 0; i < totalMonths; i += 2) {
                    const x = padding.left + (chartWidth / totalMonths) * i + (chartWidth / totalMonths) / 2;
                    ctx.fillText(months[i], x, height - padding.bottom + 10);
                }
                
                // Draw legend at the top
                const legendY = padding.top - 50;
                const legendX = padding.left;
                const legendItems = [
                    { name: 'Opessocius', color: '#2563eb', risk: '0%' },
                    { name: 'Savings Account', color: '#6b7280', risk: '0%' },
                    { name: 'S&P 500', color: '#f97316', risk: '100%' }
                ];
                
                let currentX = legendX;
                const legendSpacing = 180;
                
                legendItems.forEach((item) => {
                    // Draw colored line
                    ctx.strokeStyle = item.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(currentX, legendY);
                    ctx.lineTo(currentX + 30, legendY);
                    ctx.stroke();
                    
                    // Draw name
                    ctx.fillStyle = '#1f2937';
                    ctx.font = 'bold 13px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText(item.name, currentX + 35, legendY + 5);
                    
                    // Draw risk percentage below
                    ctx.fillStyle = '#6b7280';
                    ctx.font = '11px Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                    ctx.fillText(`Risk: ${item.risk}`, currentX + 35, legendY + 20);
                    
                    // Move to next position
                    currentX += legendSpacing;
                });
            }
            
            // Setup performance chart hover
            function setupPerformanceChartHover() {
                const canvas = document.getElementById('performance-chart');
                const tooltip = document.getElementById('performance-tooltip');
                if (!canvas || !tooltip) return;
                
                canvas.addEventListener('mousemove', function(e) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Find nearest data point
                    let nearestPoint = null;
                    let minDistance = Infinity;
                    
                    performanceDataPoints.forEach(point => {
                        const distance = Math.sqrt(Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2));
                        if (distance < 30 && distance < minDistance) {
                            minDistance = distance;
                            nearestPoint = point;
                        }
                    });
                    
                    if (nearestPoint) {
                        const formattedValue = '€' + nearestPoint.value.toLocaleString('en-US');
                        const growthSign = parseFloat(nearestPoint.growthPercent) >= 0 ? '+' : '';
                        tooltip.innerHTML = `
                            <div class="tooltip-name" style="color: ${nearestPoint.color}; font-weight: 600;">${nearestPoint.name}</div>
                            <div class="tooltip-balance">${formattedValue}</div>
                            <div class="tooltip-growth">${growthSign}${nearestPoint.growthPercent}%</div>
                        `;
                        tooltip.style.display = 'block';
                        tooltip.style.left = (nearestPoint.x + 10) + 'px';
                        tooltip.style.top = (nearestPoint.y - 40) + 'px';
                    } else {
                        tooltip.style.display = 'none';
                    }
                });
                
                canvas.addEventListener('mouseleave', function() {
                    if (tooltip) tooltip.style.display = 'none';
                });
            }
            
            // Setup performance hover after chart is drawn
            setTimeout(setupPerformanceChartHover, 150);

            // Reports Section - Generate widgets
            function generateReportWidgets() {
                const container = document.getElementById('reports-widgets-container');
                if (!container) return;
                
                // Investment data (same as portfolio chart)
                const initialInvestment = 230000;
                const opessociusHistorical = [
                    initialInvestment,  // Month 0
                    235000, 238000, 242000, 245000, 248000, 252000, 255000, 260000, 265000, 270000, 275000, 280000
                ];
                
                // Projection (2% compound growth per month)
                const projection = [];
                let lastValue = opessociusHistorical[opessociusHistorical.length - 1];
                for (let i = 0; i < 12; i++) {
                    lastValue = lastValue * 1.02;
                    projection.push(Math.round(lastValue));
                }
                
                const allData = [...opessociusHistorical.slice(1), ...projection]; // Skip Month 0 for display
                
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                
                // Generate widgets for each month
                container.innerHTML = '';
                
                // 2024 months (12 months, starting from January)
                for (let i = 0; i < 12; i++) {
                    const balance = allData[i];
                    const gainPercent = ((balance - initialInvestment) / initialInvestment * 100).toFixed(2);
                    const monthName = monthNames[i];
                    const monthValue = `2024-${String(i + 1).padStart(2, '0')}`;
                    
                    const widget = createReportWidget(monthName, 2024, balance, gainPercent, monthValue, 'monthly');
                    container.appendChild(widget);
                }
                
                // 2025 months (6 months shown)
                for (let i = 0; i < 6; i++) {
                    const balance = allData[12 + i];
                    const gainPercent = ((balance - initialInvestment) / initialInvestment * 100).toFixed(2);
                    const monthName = monthNames[i];
                    const monthValue = `2025-${String(i + 1).padStart(2, '0')}`;
                    
                    const widget = createReportWidget(monthName, 2025, balance, gainPercent, monthValue, 'monthly');
                    container.appendChild(widget);
                }
                
                // Add yearly widget (2025 only, no 2024 yearly)
                const year2025EndBalance = allData[17]; // June 2025 (projected)
                const year2025Gain = ((year2025EndBalance - initialInvestment) / initialInvestment * 100).toFixed(2);
                const year2025Widget = createReportWidget('Full Year', 2025, year2025EndBalance, year2025Gain, '2025', 'yearly');
                container.appendChild(year2025Widget); // Add at the end
            }
            
            function createReportWidget(periodName, year, balance, gainPercent, value, type) {
                const widget = document.createElement('div');
                widget.className = 'report-widget';
                
                const periodText = type === 'yearly' ? `${year}` : `${periodName} ${year}`;
                const fileName = type === 'yearly' 
                    ? `Yearly_Report_${year}.pdf`
                    : `Monthly_Report_${periodName}_${year}.pdf`;
                
                widget.innerHTML = `
                    <div class="report-widget-header">
                        <div class="report-widget-period">${periodText}</div>
                        <button class="report-widget-download" data-period="${value}" data-type="${type}" data-filename="${fileName}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="report-widget-body">
                        <div class="report-widget-metric">
                            <div class="report-widget-label">Gain %</div>
                            <div class="report-widget-value report-widget-gain">+${gainPercent}%</div>
                        </div>
                        <div class="report-widget-metric">
                            <div class="report-widget-label">Ending Balance</div>
                            <div class="report-widget-value">€${balance.toLocaleString('en-US')}</div>
                        </div>
                    </div>
                `;
                
                // Add download functionality
                const downloadBtn = widget.querySelector('.report-widget-download');
                downloadBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const filename = this.getAttribute('data-filename');
                    const period = this.getAttribute('data-period');
                    
                    // Trigger download
                    alert(`Downloading ${filename}\n\nNote: This is a demo. In production, this would generate and download the actual PDF report.`);
                });
                
                return widget;
            }
            
            // Generate widgets when Reports view is shown
            const reportsView = document.getElementById('reports-view');
            if (reportsView) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            if (reportsView.style.display !== 'none') {
                                generateReportWidgets();
                            }
                        }
                    });
                });
                observer.observe(reportsView, { attributes: true, attributeFilter: ['style'] });
            }
            
            // Dashboard form handlers
            const depositForm = document.getElementById('deposit-form');
            const withdrawalForm = document.getElementById('withdrawal-form');
            
            if (depositForm) {
                depositForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const amount = document.getElementById('deposit-amount').value;
                    if (amount) {
                        alert(`Deposit request of €${parseFloat(amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} has been sent to your advisor. You will receive a response within 24 hours.`);
                        depositForm.reset();
                    }
                });
            }
            
            if (withdrawalForm) {
                withdrawalForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const amount = document.getElementById('withdrawal-amount').value;
                    if (amount) {
                        alert(`Withdrawal request of €${parseFloat(amount).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} has been sent to your advisor. You will receive a response within 24 hours.`);
                        withdrawalForm.reset();
                    }
                });
            }
            
            // Dashboard navigation links
            const dashboardNewsLink = document.getElementById('dashboard-news-link');
            
            if (dashboardNewsLink) {
                dashboardNewsLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    const navItems = document.querySelectorAll('.sidebar-nav-item');
                    navItems.forEach(item => {
                        const span = item.querySelector('span');
                        if (span && span.textContent.trim() === 'Market News') {
                            item.click();
                        }
                    });
                });
            }
            
            // Dashboard report download buttons
            const dashboardReportDownloads = document.querySelectorAll('.dashboard-report-download');
            dashboardReportDownloads.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const month = this.getAttribute('data-month');
                    const monthNames = {
                        '2024-10': 'October_2024',
                        '2024-11': 'November_2024',
                        '2024-12': 'December_2024',
                        '2025-01': 'January_2025'
                    };
                    const filename = `Monthly_Report_${monthNames[month]}.pdf`;
                    alert(`Downloading ${filename}\n\nNote: This is a demo. In production, this would generate and download the actual PDF report.`);
                });
            });
            
            
            // Dashboard news widget click handler
            const dashboardNewsWidget = document.getElementById('dashboard-news-widget');
            if (dashboardNewsWidget) {
                dashboardNewsWidget.style.cursor = 'pointer';
                dashboardNewsWidget.addEventListener('click', function() {
                    const navItems = document.querySelectorAll('.sidebar-nav-item');
                    navItems.forEach(item => {
                        const span = item.querySelector('span');
                        if (span && span.textContent.trim() === 'Market News') {
                            item.click();
                        }
                    });
                });
            }
            
            // Draw dashboard charts when dashboard is shown
            const dashboardViewEl = document.getElementById('dashboard-view');
            if (dashboardViewEl) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            if (dashboardViewEl.style.display !== 'none') {
                                setTimeout(function() {
                                    calculateProjectionValue();
                                }, 100);
                            }
                        }
                    });
                });
                observer.observe(dashboardViewEl, { attributes: true, attributeFilter: ['style'] });
            }
            
            // Calculate 12-month projection value
            function calculateProjectionValue() {
                const projectionValueEl = document.getElementById('dashboard-projection-value');
                const portfolioProjectionEl = document.getElementById('portfolio-projection');
                
                // Use same calculation as portfolio chart (2% compound growth per month)
                const monthlyGrowthRate = 0.02; // 2% per month
                let balance = 287450; // Current balance (month 12)
                
                // Calculate 12 months forward
                for (let i = 0; i < 12; i++) {
                    balance = balance * (1 + monthlyGrowthRate);
                }
                
                // Round to whole number and format
                const projectedValue = Math.round(balance);
                const formattedValue = '€' + projectedValue.toLocaleString('en-US');
                
                if (projectionValueEl) {
                    projectionValueEl.textContent = formattedValue;
                }
                if (portfolioProjectionEl) {
                    portfolioProjectionEl.textContent = formattedValue;
                }
            }
            
            // Initial draw if dashboard is visible
            if (dashboardViewEl && dashboardViewEl.style.display !== 'none') {
                setTimeout(function() {
                    calculateProjectionValue();
                }, 100);
            }

            // Redraw chart on window resize
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    if (portfolioView && portfolioView.style.display !== 'none') {
                        drawPortfolioChart();
                    }
                    if (performanceView && performanceView.style.display !== 'none') {
                        drawPerformanceChart();
                        setTimeout(setupPerformanceChartHover, 150);
                    }
                    // Dashboard widgets resized
                }, 250);
            });
            
            // Learning Modules Section
            // Modules data (same as admin portal, but users can only view)
            let modulesData = [
                {
                    id: 1,
                    title: 'Introduction to Crude Oil Trading',
                    description: 'Learn the fundamentals of crude oil trading, including market basics, key terminology, and trading strategies.',
                    image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&h=400&fit=crop',
                    content: `
                        <h3>Understanding Crude Oil Markets</h3>
                        <p>Crude oil is one of the most important commodities in the global economy. This module covers:</p>
                        <ul>
                            <li>Market fundamentals</li>
                            <li>Trading terminology</li>
                            <li>Price factors</li>
                            <li>Risk management</li>
                        </ul>
                        
                        <h3 style="margin-top: 2rem;">What is Crude Oil?</h3>
                        <p>Crude oil, also known as petroleum, is a naturally occurring, unrefined petroleum product composed of hydrocarbon deposits and other organic materials. It is a fossil fuel that is extracted from the ground and refined into various products such as gasoline, diesel, jet fuel, and heating oil.</p>
                        <p>The global crude oil market is one of the largest and most liquid commodity markets in the world, with daily trading volumes exceeding billions of dollars. Understanding this market is crucial for anyone looking to trade energy commodities.</p>
                        
                        <h3 style="margin-top: 2rem;">Types of Crude Oil</h3>
                        <p>There are several types of crude oil, each with different characteristics that affect their price and trading:</p>
                        <ul>
                            <li><strong>West Texas Intermediate (WTI):</strong> A high-quality crude oil benchmark produced in the United States. It is light and sweet, making it ideal for refining into gasoline.</li>
                            <li><strong>Brent Crude:</strong> A major trading classification of sweet light crude oil that serves as a major benchmark price for purchases of oil worldwide. It is extracted from the North Sea.</li>
                            <li><strong>Dubai Crude:</strong> A medium sour crude oil produced in Dubai and used as a benchmark for pricing Middle Eastern crude oil exports to Asia.</li>
                            <li><strong>OPEC Basket:</strong> A weighted average of oil prices from various OPEC member countries, used as a reference price for OPEC crude oil.</li>
                        </ul>
                        
                        <h3 style="margin-top: 2rem;">Market Fundamentals</h3>
                        <p>The crude oil market is driven by a complex interplay of supply and demand factors. Understanding these fundamentals is essential for successful trading:</p>
                        
                        <h4 style="margin-top: 1.5rem;">Supply Factors</h4>
                        <p>Supply factors that influence crude oil prices include:</p>
                        <ul>
                            <li><strong>Production Levels:</strong> The amount of crude oil being produced by major oil-producing countries, particularly OPEC members, Russia, and the United States.</li>
                            <li><strong>Geopolitical Events:</strong> Wars, sanctions, and political instability in oil-producing regions can disrupt supply chains and affect prices.</li>
                            <li><strong>Natural Disasters:</strong> Hurricanes, earthquakes, and other natural disasters can damage oil infrastructure and reduce production.</li>
                            <li><strong>Technological Advances:</strong> Innovations in extraction technology, such as fracking and deep-water drilling, can increase supply.</li>
                            <li><strong>Storage Levels:</strong> The amount of crude oil in storage facilities affects available supply and can signal market sentiment.</li>
                        </ul>
                        
                        <h4 style="margin-top: 1.5rem;">Demand Factors</h4>
                        <p>Demand factors that influence crude oil prices include:</p>
                        <ul>
                            <li><strong>Economic Growth:</strong> Strong economic growth typically increases energy consumption, driving up demand for crude oil.</li>
                            <li><strong>Seasonal Variations:</strong> Demand for heating oil increases in winter, while gasoline demand peaks during summer driving season.</li>
                            <li><strong>Transportation Needs:</strong> The global transportation sector is heavily dependent on petroleum products, making it a major demand driver.</li>
                            <li><strong>Industrial Activity:</strong> Manufacturing and industrial processes require significant amounts of energy derived from crude oil.</li>
                            <li><strong>Alternative Energy:</strong> The growth of renewable energy sources and electric vehicles can reduce long-term demand for crude oil.</li>
                        </ul>
                        
                        <h3 style="margin-top: 2rem;">Trading Terminology</h3>
                        <p>To effectively trade crude oil, you need to understand the key terminology used in the market:</p>
                        <ul>
                            <li><strong>Barrel:</strong> The standard unit of measurement for crude oil, equal to 42 US gallons or approximately 159 liters.</li>
                            <li><strong>Spot Price:</strong> The current market price at which crude oil can be bought or sold for immediate delivery.</li>
                            <li><strong>Futures Contract:</strong> A standardized agreement to buy or sell a specific quantity of crude oil at a predetermined price on a future date.</li>
                            <li><strong>Contango:</strong> A market condition where futures prices are higher than spot prices, typically indicating expectations of higher future prices.</li>
                            <li><strong>Backwardation:</strong> A market condition where futures prices are lower than spot prices, often indicating supply shortages or high immediate demand.</li>
                            <li><strong>Spread:</strong> The price difference between two related crude oil contracts, such as the WTI-Brent spread.</li>
                            <li><strong>Volatility:</strong> A measure of how much crude oil prices fluctuate over time, indicating market uncertainty.</li>
                        </ul>
                        
                        <h3 style="margin-top: 2rem;">Price Factors</h3>
                        <p>Several key factors influence crude oil prices on a daily basis:</p>
                        
                        <h4 style="margin-top: 1.5rem;">OPEC Decisions</h4>
                        <p>The Organization of the Petroleum Exporting Countries (OPEC) plays a crucial role in global oil markets. OPEC decisions regarding production quotas can significantly impact prices. When OPEC reduces production, prices typically rise, and when they increase production, prices usually fall.</p>
                        
                        <h4 style="margin-top: 1.5rem;">US Dollar Strength</h4>
                        <p>Crude oil is priced in US dollars, so the strength of the dollar directly affects oil prices. A stronger dollar makes oil more expensive for buyers using other currencies, potentially reducing demand and lowering prices. Conversely, a weaker dollar makes oil cheaper for international buyers, potentially increasing demand.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Inventory Reports</h4>
                        <p>Weekly inventory reports from organizations like the US Energy Information Administration (EIA) and the American Petroleum Institute (API) provide crucial data on oil stockpiles. Higher-than-expected inventory levels typically indicate oversupply and can push prices down, while lower-than-expected levels suggest tight supply and can drive prices up.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Economic Indicators</h4>
                        <p>Economic indicators such as GDP growth, employment data, and manufacturing indices provide insights into economic health and energy demand. Strong economic indicators often correlate with higher oil demand and prices.</p>
                        
                        <h3 style="margin-top: 2rem;">Risk Management</h3>
                        <p>Effective risk management is essential when trading crude oil, as the market can be highly volatile. Here are key risk management strategies:</p>
                        
                        <h4 style="margin-top: 1.5rem;">Position Sizing</h4>
                        <p>Never risk more than you can afford to lose on a single trade. A common rule is to risk no more than 1-2% of your trading capital on any single position. This helps protect your account from significant losses during adverse market movements.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Stop-Loss Orders</h4>
                        <p>Always use stop-loss orders to limit potential losses. A stop-loss order automatically closes your position if the price moves against you by a predetermined amount. This prevents emotional decision-making and helps protect your capital.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Diversification</h4>
                        <p>Don't put all your capital into crude oil trading. Diversify your portfolio across different asset classes and commodities to reduce overall risk. This way, losses in one area can be offset by gains in others.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Stay Informed</h4>
                        <p>Keep up with market news, economic data releases, and geopolitical events that could affect oil prices. Being informed helps you make better trading decisions and avoid unexpected market moves.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Use Leverage Wisely</h4>
                        <p>While leverage can amplify profits, it also amplifies losses. Use leverage conservatively and understand the risks involved. High leverage can quickly wipe out your trading account if the market moves against you.</p>
                        
                        <h3 style="margin-top: 2rem;">Trading Strategies</h3>
                        <p>There are several approaches to trading crude oil, each with its own advantages and risks:</p>
                        
                        <h4 style="margin-top: 1.5rem;">Day Trading</h4>
                        <p>Day trading involves opening and closing positions within the same trading day. This strategy requires constant monitoring of the market and quick decision-making. Day traders typically focus on short-term price movements and technical analysis.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Swing Trading</h4>
                        <p>Swing trading involves holding positions for several days to weeks, capturing medium-term price movements. This approach allows traders to take advantage of larger price swings while avoiding the stress of constant monitoring required in day trading.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Trend Following</h4>
                        <p>Trend following strategies involve identifying and trading in the direction of established market trends. This approach assumes that prices will continue moving in the same direction until the trend reverses.</p>
                        
                        <h4 style="margin-top: 1.5rem;">Fundamental Analysis</h4>
                        <p>Fundamental analysis focuses on supply and demand factors, economic indicators, and geopolitical events to predict price movements. This approach is better suited for longer-term trading and investment decisions.</p>
                        
                        <h3 style="margin-top: 2rem;">Conclusion</h3>
                        <p>Crude oil trading offers significant opportunities for profit, but it also comes with substantial risks. Success in this market requires a solid understanding of market fundamentals, trading terminology, price factors, and risk management principles.</p>
                        <p>Remember that no trading strategy guarantees profits, and losses are an inevitable part of trading. The key to long-term success is consistent application of sound trading principles, continuous learning, and disciplined risk management.</p>
                        <p>As you continue your journey in crude oil trading, always stay informed about market developments, practice with a demo account before risking real money, and never invest more than you can afford to lose.</p>
                    `,
                    additionalImages: [],
                    order: 1,
                    published: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Technical Analysis Fundamentals',
                    description: 'Master the art of technical analysis with charts, indicators, and patterns used by professional traders.',
                    image: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=800&h=400&fit=crop',
                    content: '<h3>Chart Patterns and Indicators</h3><p>Technical analysis is crucial for successful trading. This module teaches:</p><ul><li>Reading price charts</li><li>Common patterns</li><li>Technical indicators</li><li>Entry and exit signals</li></ul>',
                    additionalImages: [],
                    order: 2,
                    published: true,
                    createdAt: new Date().toISOString()
                }
            ];
            
            function loadModulesList() {
                const container = document.getElementById('modules-grid');
                if (!container) return;
                
                container.innerHTML = '';
                
                // Sort modules by order and filter only published ones
                const sortedModules = [...modulesData]
                    .filter(m => m.published)
                    .sort((a, b) => a.order - b.order);
                
                sortedModules.forEach(module => {
                    const moduleCard = document.createElement('div');
                    moduleCard.style.background = 'white';
                    moduleCard.style.borderRadius = '8px';
                    moduleCard.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                    moduleCard.style.overflow = 'hidden';
                    moduleCard.style.display = 'flex';
                    moduleCard.style.flexDirection = 'column';
                    moduleCard.style.cursor = 'pointer';
                    moduleCard.style.transition = 'transform 0.2s, box-shadow 0.2s';
                    
                    moduleCard.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px)';
                        this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                    });
                    
                    moduleCard.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                    });
                    
                    moduleCard.addEventListener('click', function() {
                        viewModule(module.id);
                    });
                    
                    const imageContainer = document.createElement('div');
                    imageContainer.style.width = '100%';
                    imageContainer.style.height = '200px';
                    imageContainer.style.overflow = 'hidden';
                    imageContainer.style.background = '#f3f4f6';
                    
                    const img = document.createElement('img');
                    img.src = module.image || 'https://via.placeholder.com/400x200?text=No+Image';
                    img.alt = module.title;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    
                    imageContainer.appendChild(img);
                    
                    const cardBody = document.createElement('div');
                    cardBody.style.padding = '1.5rem';
                    cardBody.style.flex = '1';
                    cardBody.style.display = 'flex';
                    cardBody.style.flexDirection = 'column';
                    
                    const title = document.createElement('h3');
                    title.textContent = module.title;
                    title.style.margin = '0 0 0.5rem 0';
                    title.style.fontSize = '1.25rem';
                    title.style.color = '#1f2937';
                    title.style.fontWeight = '600';
                    
                    const description = document.createElement('p');
                    description.textContent = module.description || 'No description available.';
                    description.style.margin = '0 0 1rem 0';
                    description.style.color = '#6b7280';
                    description.style.fontSize = '0.875rem';
                    description.style.lineHeight = '1.5';
                    
                    const viewBtn = document.createElement('button');
                    viewBtn.textContent = 'View Module';
                    viewBtn.style.width = '100%';
                    viewBtn.style.marginTop = 'auto';
                    viewBtn.style.padding = '0.75rem 1.5rem';
                    viewBtn.style.fontSize = '0.875rem';
                    viewBtn.style.fontWeight = '600';
                    viewBtn.style.background = '#1f2937';
                    viewBtn.style.color = 'white';
                    viewBtn.style.border = 'none';
                    viewBtn.style.borderRadius = '8px';
                    viewBtn.style.cursor = 'pointer';
                    viewBtn.style.transition = 'background 0.2s';
                    viewBtn.addEventListener('mouseenter', function() {
                        this.style.background = '#374151';
                    });
                    viewBtn.addEventListener('mouseleave', function() {
                        this.style.background = '#1f2937';
                    });
                    viewBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        viewModule(module.id);
                    });
                    
                    cardBody.appendChild(title);
                    cardBody.appendChild(description);
                    cardBody.appendChild(viewBtn);
                    
                    moduleCard.appendChild(imageContainer);
                    moduleCard.appendChild(cardBody);
                    container.appendChild(moduleCard);
                });
            }
            
            function viewModule(moduleId) {
                const module = modulesData.find(m => m.id === moduleId);
                if (!module) return;
                
                const modulesListView = document.getElementById('modules-list-view');
                const moduleDetailView = document.getElementById('module-detail-view');
                const moduleDetailContent = document.getElementById('module-detail-content');
                
                if (!modulesListView || !moduleDetailView || !moduleDetailContent) return;
                
                // Hide modules list and show module detail
                modulesListView.style.display = 'none';
                moduleDetailView.style.display = 'block';
                
                // Populate module content
                moduleDetailContent.innerHTML = `
                    <h2 style="margin: 0 0 1rem 0; font-size: 2rem; color: #1f2937; font-weight: 700;">${module.title}</h2>
                    ${module.image ? `<img src="${module.image}" alt="${module.title}" style="width: 100%; max-height: 400px; object-fit: cover; border-radius: 8px; margin-bottom: 2rem;">` : ''}
                    ${module.description ? `<p style="color: #6b7280; margin-bottom: 2rem; font-size: 1.125rem; line-height: 1.6;">${module.description}</p>` : ''}
                    <div style="border-top: 1px solid #e5e7eb; padding-top: 2rem; color: #374151; line-height: 1.8;">
                        ${module.content || '<p>No content available.</p>'}
                    </div>
                    ${module.additionalImages && module.additionalImages.length > 0 ? `
                        <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;">
                            ${module.additionalImages.map(img => `<img src="${img}" alt="Additional image" style="width: 100%; border-radius: 8px; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">`).join('')}
                        </div>
                    ` : ''}
                `;
                
                // Scroll to top
                window.scrollTo(0, 0);
                
                // Attach close button handler
                const closeBtn = document.getElementById('close-module-btn');
                if (closeBtn) {
                    // Remove existing listeners by cloning and replacing
                    const newCloseBtn = closeBtn.cloneNode(true);
                    closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
                    newCloseBtn.addEventListener('click', closeModuleView);
                }
            }
            
            function closeModuleView() {
                const modulesListView = document.getElementById('modules-list-view');
                const moduleDetailView = document.getElementById('module-detail-view');
                
                if (modulesListView) modulesListView.style.display = 'block';
                if (moduleDetailView) moduleDetailView.style.display = 'none';
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
            
            // Close module button handler
            const closeModuleBtn = document.getElementById('close-module-btn');
            if (closeModuleBtn) {
                closeModuleBtn.addEventListener('click', closeModuleView);
            }
            
            // Community Group Chat Section
            let communityChatMessages = [
                {
                    id: 1,
                    sender: 'Admin',
                    message: 'Welcome to the community chat! Feel free to ask questions and share insights.',
                    images: [],
                    timestamp: new Date(Date.now() - 3600000).toISOString() // 1 hour ago
                },
                {
                    id: 2,
                    sender: 'John Investor',
                    message: 'Thanks! Looking forward to learning more about the market trends.',
                    images: [],
                    timestamp: new Date(Date.now() - 3300000).toISOString() // 55 minutes ago
                }
            ];
            
            function loadCommunityChatMessages() {
                const container = document.getElementById('community-chat-messages-container');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (communityChatMessages.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">No messages yet. Start the conversation!</p>';
                    return;
                }
                
                communityChatMessages.forEach(msg => {
                    const messageDiv = document.createElement('div');
                    messageDiv.style.display = 'flex';
                    messageDiv.style.flexDirection = 'column';
                    messageDiv.style.gap = '0.25rem';
                    messageDiv.style.maxWidth = '80%';
                    messageDiv.style.marginLeft = msg.sender === 'Admin' ? 'auto' : '0';
                    
                    const senderName = document.createElement('div');
                    senderName.style.fontSize = '0.75rem';
                    senderName.style.fontWeight = '600';
                    senderName.style.color = msg.sender === 'Admin' ? '#2563eb' : '#6b7280';
                    senderName.textContent = msg.sender;
                    
                    const messageBubble = document.createElement('div');
                    messageBubble.style.padding = '0.75rem 1rem';
                    messageBubble.style.borderRadius = '12px';
                    messageBubble.style.background = msg.sender === 'Admin' ? '#2563eb' : 'white';
                    messageBubble.style.color = msg.sender === 'Admin' ? 'white' : '#1f2937';
                    messageBubble.style.border = msg.sender === 'Admin' ? 'none' : '1px solid #e5e7eb';
                    messageBubble.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.05)';
                    
                    if (msg.message) {
                        const messageText = document.createElement('div');
                        messageText.style.fontSize = '0.875rem';
                        messageText.style.lineHeight = '1.5';
                        messageText.style.whiteSpace = 'pre-wrap';
                        messageText.style.wordBreak = 'break-word';
                        messageText.textContent = msg.message;
                        messageBubble.appendChild(messageText);
                    }
                    
                    if (msg.images && msg.images.length > 0) {
                        const imagesContainer = document.createElement('div');
                        imagesContainer.style.display = 'grid';
                        imagesContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
                        imagesContainer.style.gap = '0.5rem';
                        imagesContainer.style.marginTop = msg.message ? '0.5rem' : '0';
                        
                        msg.images.forEach(imgUrl => {
                            const img = document.createElement('img');
                            img.src = imgUrl;
                            img.style.width = '100%';
                            img.style.height = '150px';
                            img.style.objectFit = 'cover';
                            img.style.borderRadius = '6px';
                            img.style.cursor = 'pointer';
                            img.onclick = function() {
                                window.open(imgUrl, '_blank');
                            };
                            imagesContainer.appendChild(img);
                        });
                        messageBubble.appendChild(imagesContainer);
                    }
                    
                    const timestamp = document.createElement('div');
                    timestamp.style.fontSize = '0.625rem';
                    timestamp.style.color = '#9ca3af';
                    timestamp.style.marginTop = '0.25rem';
                    timestamp.style.textAlign = msg.sender === 'Admin' ? 'right' : 'left';
                    const date = new Date(msg.timestamp);
                    timestamp.textContent = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    
                    messageDiv.appendChild(senderName);
                    messageDiv.appendChild(messageBubble);
                    messageDiv.appendChild(timestamp);
                    container.appendChild(messageDiv);
                });
                
                // Scroll to bottom
                container.scrollTop = container.scrollHeight;
            }
            
            // Community Chat image preview
            let selectedCommunityChatImages = [];
            const communityChatImageInput = document.getElementById('community-chat-image-input');
            const communityChatImagesPreview = document.getElementById('community-chat-images-preview');
            const communityChatImagesPreviewContainer = document.getElementById('community-chat-images-preview-container');
            
            if (communityChatImageInput && communityChatImagesPreview && communityChatImagesPreviewContainer) {
                communityChatImageInput.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    selectedCommunityChatImages = files;
                    communityChatImagesPreviewContainer.innerHTML = '';
                    
                    if (files.length > 0) {
                        communityChatImagesPreview.style.display = 'block';
                    } else {
                        communityChatImagesPreview.style.display = 'none';
                    }
                    
                    files.forEach((file, index) => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const imgDiv = document.createElement('div');
                                imgDiv.style.position = 'relative';
                                imgDiv.style.width = '80px';
                                imgDiv.style.height = '80px';
                                
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.style.width = '100%';
                                img.style.height = '100%';
                                img.style.objectFit = 'cover';
                                img.style.borderRadius = '6px';
                                img.style.border = '1px solid #e5e7eb';
                                
                                const removeBtn = document.createElement('button');
                                removeBtn.textContent = '×';
                                removeBtn.style.position = 'absolute';
                                removeBtn.style.top = '-8px';
                                removeBtn.style.right = '-8px';
                                removeBtn.style.background = '#ef4444';
                                removeBtn.style.color = 'white';
                                removeBtn.style.border = 'none';
                                removeBtn.style.borderRadius = '50%';
                                removeBtn.style.width = '20px';
                                removeBtn.style.height = '20px';
                                removeBtn.style.cursor = 'pointer';
                                removeBtn.style.fontSize = '14px';
                                removeBtn.style.lineHeight = '1';
                                removeBtn.onclick = function() {
                                    selectedCommunityChatImages = selectedCommunityChatImages.filter((f, i) => i !== index);
                                    const dt = new DataTransfer();
                                    selectedCommunityChatImages.forEach(f => dt.items.add(f));
                                    communityChatImageInput.files = dt.files;
                                    if (selectedCommunityChatImages.length === 0) {
                                        communityChatImagesPreview.style.display = 'none';
                                    } else {
                                        communityChatImageInput.dispatchEvent(new Event('change'));
                                    }
                                };
                                
                                imgDiv.appendChild(img);
                                imgDiv.appendChild(removeBtn);
                                communityChatImagesPreviewContainer.appendChild(imgDiv);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                });
            }
            
            // Send community chat message
            const communityChatSendBtn = document.getElementById('community-chat-send-btn');
            const communityChatMessageInput = document.getElementById('community-chat-message-input');
            
            function sendCommunityChatMessage() {
                const messageText = communityChatMessageInput.value.trim();
                const images = selectedCommunityChatImages;
                
                if (!messageText && images.length === 0) {
                    return;
                }
                
                // Process images
                const imageUrls = [];
                images.forEach(file => {
                    imageUrls.push(URL.createObjectURL(file));
                });
                
                // Add message
                const newMessage = {
                    id: communityChatMessages.length + 1,
                    sender: 'John Investor',
                    message: messageText,
                    images: imageUrls,
                    timestamp: new Date().toISOString()
                };
                
                communityChatMessages.push(newMessage);
                loadCommunityChatMessages();
                
                // Clear input
                communityChatMessageInput.value = '';
                selectedCommunityChatImages = [];
                communityChatImageInput.value = '';
                communityChatImagesPreview.style.display = 'none';
                communityChatImagesPreviewContainer.innerHTML = '';
            }
            
            if (communityChatSendBtn) {
                communityChatSendBtn.addEventListener('click', sendCommunityChatMessage);
                // Add hover effect
                communityChatSendBtn.addEventListener('mouseenter', function() {
                    this.style.background = '#1d4ed8';
                });
                communityChatSendBtn.addEventListener('mouseleave', function() {
                    this.style.background = '#2563eb';
                });
            }
            
            if (communityChatMessageInput) {
                communityChatMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendCommunityChatMessage();
                    }
                });
            }
            
            // Professors' Messages Section
            let professorsMessages = [
                {
                    id: 1,
                    professor: 'Dr. Sarah Johnson',
                    title: 'Market Analysis Expert',
                    message: 'The crude oil market is showing strong fundamentals this quarter. Key indicators suggest continued upward momentum.',
                    timestamp: new Date(Date.now() - 7200000).toISOString() // 2 hours ago
                },
                {
                    id: 2,
                    professor: 'Prof. Michael Chen',
                    title: 'Trading Strategy Specialist',
                    message: 'Remember to always use stop-loss orders when trading volatile commodities. Risk management is crucial for long-term success.',
                    timestamp: new Date(Date.now() - 10800000).toISOString() // 3 hours ago
                },
                {
                    id: 3,
                    professor: 'Dr. Emily Rodriguez',
                    title: 'Energy Economics Professor',
                    message: 'OPEC decisions continue to be a major driver of oil prices. Keep an eye on production quotas and inventory reports.',
                    timestamp: new Date(Date.now() - 14400000).toISOString() // 4 hours ago
                },
                {
                    id: 4,
                    professor: 'Prof. James Wilson',
                    title: 'Technical Analysis Expert',
                    message: 'The current chart patterns suggest a potential breakout. Monitor key resistance levels closely in the coming days.',
                    timestamp: new Date(Date.now() - 18000000).toISOString() // 5 hours ago
                }
            ];
            
            function loadProfessorsMessages() {
                const container = document.getElementById('professors-messages-container');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (professorsMessages.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">No messages from professors yet.</p>';
                    return;
                }
                
                // Sort messages by timestamp (oldest first) so users scroll down to see newer messages
                const sortedMessages = [...professorsMessages].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                sortedMessages.forEach(msg => {
                    const messageCard = document.createElement('div');
                    messageCard.style.background = 'white';
                    messageCard.style.padding = '1rem';
                    messageCard.style.borderRadius = '8px';
                    messageCard.style.border = '1px solid #e5e7eb';
                    messageCard.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.05)';
                    messageCard.style.flexShrink = '0';
                    messageCard.style.width = '100%';
                    messageCard.style.boxSizing = 'border-box';
                    
                    const professorName = document.createElement('div');
                    professorName.style.fontSize = '0.875rem';
                    professorName.style.fontWeight = '700';
                    professorName.style.color = '#1f2937';
                    professorName.style.marginBottom = '0.25rem';
                    professorName.textContent = msg.professor;
                    
                    const professorTitle = document.createElement('div');
                    professorTitle.style.fontSize = '0.75rem';
                    professorTitle.style.color = '#2563eb';
                    professorTitle.style.marginBottom = '0.75rem';
                    professorTitle.textContent = msg.title;
                    
                    const messageText = document.createElement('div');
                    messageText.style.fontSize = '0.875rem';
                    messageText.style.color = '#374151';
                    messageText.style.lineHeight = '1.6';
                    messageText.style.marginBottom = '0.75rem';
                    messageText.style.whiteSpace = 'pre-wrap';
                    messageText.style.wordBreak = 'break-word';
                    messageText.textContent = msg.message;
                    
                    const timestamp = document.createElement('div');
                    timestamp.style.fontSize = '0.625rem';
                    timestamp.style.color = '#9ca3af';
                    const date = new Date(msg.timestamp);
                    timestamp.textContent = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) + ' • ' + date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    
                    messageCard.appendChild(professorName);
                    messageCard.appendChild(professorTitle);
                    messageCard.appendChild(messageText);
                    messageCard.appendChild(timestamp);
                    container.appendChild(messageCard);
                });
                
                // Scroll to bottom to show most recent messages initially
                container.scrollTop = container.scrollHeight;
            }
            
            // Weekly Reports Section
            // Sample weekly report data (in a real app, this would come from the admin portal)
            let weeklyReportData = {
                author: 'Dr. Sarah Johnson',
                datePublished: '2024-12-15',
                fileName: 'Weekly_Report_Dec_15_2024.pdf',
                fileUrl: '#', // In real app, this would be the actual file URL
                videoTitle: 'Weekly Market Analysis - December 15, 2024',
                videoFileName: 'weekly_analysis_dec_15_2024.mp4',
                videoUrl: '#', // In real app, this would be the actual video URL
                uploadDate: new Date().toISOString()
            };
            
            function loadWeeklyReports() {
                const container = document.getElementById('weekly-reports-display');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (!weeklyReportData) {
                    container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #6b7280;">No weekly reports available yet.</div>';
                    return;
                }
                
                // PDF Report Section (Left)
                const pdfSection = document.createElement('div');
                pdfSection.style.background = 'white';
                pdfSection.style.padding = '1.5rem';
                pdfSection.style.borderRadius = '8px';
                pdfSection.style.border = '1px solid #e5e7eb';
                pdfSection.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                pdfSection.style.display = 'flex';
                pdfSection.style.gap = '1.5rem';
                pdfSection.style.alignItems = 'center';
                
                const pdfContent = document.createElement('div');
                pdfContent.style.flex = '1';
                
                const pdfTitle = document.createElement('h4');
                pdfTitle.style.margin = '0 0 1rem 0';
                pdfTitle.style.fontSize = '1.125rem';
                pdfTitle.style.fontWeight = '600';
                pdfTitle.style.color = '#1f2937';
                pdfTitle.textContent = 'Weekly PDF Report';
                
                const pdfInfo = document.createElement('div');
                pdfInfo.style.marginBottom = '1rem';
                pdfInfo.style.fontSize = '0.875rem';
                pdfInfo.style.color = '#6b7280';
                pdfInfo.innerHTML = `
                    <div style="margin-bottom: 0.5rem;"><strong>Author:</strong> ${weeklyReportData.author}</div>
                    <div style="margin-bottom: 0.5rem;"><strong>Date Published:</strong> ${new Date(weeklyReportData.datePublished).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                    <div><strong>File:</strong> ${weeklyReportData.fileName}</div>
                `;
                
                pdfContent.appendChild(pdfTitle);
                pdfContent.appendChild(pdfInfo);
                
                // PDF Cover Image (Right)
                const pdfCoverContainer = document.createElement('div');
                pdfCoverContainer.style.flexShrink = '0';
                pdfCoverContainer.style.width = '350px';
                pdfCoverContainer.style.height = '140px';
                pdfCoverContainer.style.cursor = 'pointer';
                pdfCoverContainer.style.borderRadius = '8px';
                pdfCoverContainer.style.overflow = 'hidden';
                pdfCoverContainer.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                pdfCoverContainer.style.transition = 'transform 0.2s, box-shadow 0.2s';
                
                pdfCoverContainer.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.02)';
                    this.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.15)';
                });
                
                pdfCoverContainer.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                });
                
                pdfCoverContainer.addEventListener('click', function() {
                    if (weeklyReportData.fileUrl && weeklyReportData.fileUrl !== '#') {
                        window.open(weeklyReportData.fileUrl, '_blank');
                    } else {
                        alert('PDF download will be available once the report is uploaded by the admin.');
                    }
                });
                
                const pdfCover = document.createElement('img');
                pdfCover.src = 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=400&h=560&fit=crop';
                pdfCover.alt = 'PDF Cover';
                pdfCover.style.width = '100%';
                pdfCover.style.height = '100%';
                pdfCover.style.objectFit = 'cover';
                
                pdfCoverContainer.appendChild(pdfCover);
                
                pdfSection.appendChild(pdfContent);
                pdfSection.appendChild(pdfCoverContainer);
                
                // Video Section (Right)
                const videoSection = document.createElement('div');
                videoSection.style.background = 'white';
                videoSection.style.padding = '1.5rem';
                videoSection.style.borderRadius = '8px';
                videoSection.style.border = '1px solid #e5e7eb';
                videoSection.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                videoSection.style.display = 'flex';
                videoSection.style.gap = '1.5rem';
                videoSection.style.alignItems = 'center';
                
                const videoContent = document.createElement('div');
                videoContent.style.flex = '1';
                
                const videoTitle = document.createElement('h4');
                videoTitle.style.margin = '0 0 1rem 0';
                videoTitle.style.fontSize = '1.125rem';
                videoTitle.style.fontWeight = '600';
                videoTitle.style.color = '#1f2937';
                videoTitle.textContent = 'Weekly Analysis Video';
                
                const videoInfo = document.createElement('div');
                videoInfo.style.fontSize = '0.875rem';
                videoInfo.style.color = '#6b7280';
                videoInfo.innerHTML = `
                    <div style="margin-bottom: 0.5rem;"><strong>Title:</strong> ${weeklyReportData.videoTitle || 'Weekly Analysis Video'}</div>
                    <div><strong>File:</strong> ${weeklyReportData.videoFileName || 'N/A'}</div>
                `;
                
                videoContent.appendChild(videoTitle);
                videoContent.appendChild(videoInfo);
                
                // Video Cover Image (Right)
                const videoCoverContainer = document.createElement('div');
                videoCoverContainer.style.position = 'relative';
                videoCoverContainer.style.flexShrink = '0';
                videoCoverContainer.style.width = '350px';
                videoCoverContainer.style.height = '140px';
                videoCoverContainer.style.cursor = 'pointer';
                videoCoverContainer.style.borderRadius = '8px';
                videoCoverContainer.style.overflow = 'hidden';
                videoCoverContainer.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                videoCoverContainer.style.transition = 'transform 0.2s, box-shadow 0.2s';
                
                videoCoverContainer.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.02)';
                    this.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.15)';
                });
                
                videoCoverContainer.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                });
                
                const videoCover = document.createElement('img');
                videoCover.src = 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=560&fit=crop';
                videoCover.alt = 'Video Cover';
                videoCover.style.width = '100%';
                videoCover.style.height = '100%';
                videoCover.style.objectFit = 'cover';
                
                // Play button overlay
                const playButton = document.createElement('div');
                playButton.style.position = 'absolute';
                playButton.style.top = '50%';
                playButton.style.left = '50%';
                playButton.style.transform = 'translate(-50%, -50%)';
                playButton.style.width = '60px';
                playButton.style.height = '60px';
                playButton.style.background = 'rgba(37, 99, 235, 0.9)';
                playButton.style.borderRadius = '50%';
                playButton.style.display = 'flex';
                playButton.style.alignItems = 'center';
                playButton.style.justifyContent = 'center';
                playButton.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
                playButton.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                `;
                
                videoCoverContainer.appendChild(videoCover);
                videoCoverContainer.appendChild(playButton);
                
                // Video modal
                let videoModal = null;
                videoCoverContainer.addEventListener('click', function() {
                    if (weeklyReportData.videoUrl && weeklyReportData.videoUrl !== '#') {
                        // Create modal for video
                        videoModal = document.createElement('div');
                        videoModal.style.position = 'fixed';
                        videoModal.style.top = '0';
                        videoModal.style.left = '0';
                        videoModal.style.width = '100%';
                        videoModal.style.height = '100%';
                        videoModal.style.background = 'rgba(0, 0, 0, 0.9)';
                        videoModal.style.zIndex = '10000';
                        videoModal.style.display = 'flex';
                        videoModal.style.alignItems = 'center';
                        videoModal.style.justifyContent = 'center';
                        videoModal.style.padding = '2rem';
                        
                        const videoContainer = document.createElement('div');
                        videoContainer.style.position = 'relative';
                        videoContainer.style.maxWidth = '90%';
                        videoContainer.style.maxHeight = '90%';
                        videoContainer.style.width = '800px';
                        
                        const closeBtn = document.createElement('button');
                        closeBtn.textContent = '×';
                        closeBtn.style.position = 'absolute';
                        closeBtn.style.top = '-40px';
                        closeBtn.style.right = '0';
                        closeBtn.style.background = 'white';
                        closeBtn.style.color = '#1f2937';
                        closeBtn.style.border = 'none';
                        closeBtn.style.width = '36px';
                        closeBtn.style.height = '36px';
                        closeBtn.style.borderRadius = '50%';
                        closeBtn.style.fontSize = '24px';
                        closeBtn.style.cursor = 'pointer';
                        closeBtn.style.zIndex = '10001';
                        closeBtn.addEventListener('click', function() {
                            document.body.removeChild(videoModal);
                            videoModal = null;
                        });
                        
                        const video = document.createElement('video');
                        video.src = weeklyReportData.videoUrl;
                        video.controls = true;
                        video.style.width = '100%';
                        video.style.height = 'auto';
                        video.style.borderRadius = '8px';
                        
                        videoContainer.appendChild(closeBtn);
                        videoContainer.appendChild(video);
                        videoModal.appendChild(videoContainer);
                        document.body.appendChild(videoModal);
                        
                        // Close on background click
                        videoModal.addEventListener('click', function(e) {
                            if (e.target === videoModal) {
                                document.body.removeChild(videoModal);
                                videoModal = null;
                            }
                        });
                    } else {
                        alert('Video will be available once uploaded by the admin.');
                    }
                });
                
                videoSection.appendChild(videoContent);
                videoSection.appendChild(videoCoverContainer);
                
                container.appendChild(pdfSection);
                container.appendChild(videoSection);
            }
            
            // Load chat messages when community view is shown
            const communityView = document.getElementById('community-view');
            if (communityView) {
                // Use MutationObserver to detect when community view becomes visible
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            if (communityView.style.display !== 'none') {
                                loadCommunityChatMessages();
                                loadProfessorsMessages();
                                loadWeeklyReports();
                            }
                        }
                    });
                });
                observer.observe(communityView, { attributes: true, attributeFilter: ['style'] });
            }
    });
    </script>
</body>
</html>

